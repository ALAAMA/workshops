Regression in Stata
Ista Zahn
Harvard-MIT Data Center (HMDC)

dataclass@help.hmdc.harvard.edu

Organization
Please feel free to ask questions at any point if they are relevant to the current topic (or if you are lost!)
There will be a Q&A after class for more specific, personalized questions
Collaboration with your neighbors is encouraged
If you are using a laptop, you will need to adjust paths accordingly
Organization
Make comments in your Do-file rather than on hand-outs
Save on flash drive or email to yourself
Stata commands will always appear in red
“Var” simply refers to “variable” (e.g., var1, var2, var3, varname)
“pathname” should be replace with the path specific to your computer and folders
Assumptions (and Disclaimers)
This is Regression in Stata
Assumes basic knowledge of Stata
Assumes knowledge of regression
Not appropriate for people not familiar with Stata
Not appropriate for people already well-familiar with regression in Stata

Today’s Dataset
We have data on a variety of variables for all 50 states
Population, density, energy use, voting tendencies, graduation rates, income, etc.
We’re going to be predicting SAT scores
Univariate Regression: SAT scores and Education Expenditures
Does the amount of money spent on education affect the mean SAT score in a state?
Dependent variable: csat
Independent variable: expense

Steps for Running Regression
1. Examine descriptive statistics
2. Look at relationship graphically and test correlation(s)
3. Run and interpret regression
4. Test regression assumptions
Univariate Regression: SAT scores and Education Expenditures
First, let’s look at some descriptives
codebook csat expense
sum csat expense
Remember in OLS regression we need continuous, dichotomous or dummy-coded predictors
Outcome should be continuous
Univariate Regression: SAT scores and Education Expenditures
Univariate Regression: SAT scores and Education Expenditures
View relationship graphically
Scatterplots work well for univariate relationships
twoway scatter expense scat

Univariate Regression: SAT scores and Education Expenditures
pwcorr csat expense, star(.05)
Univariate Regression: SAT scores and Education Expenditures
regress csat expense
Univariate Regression: SAT scores and Education Expenditures
Intercept
What would we predict a state’s mean SAT score to be if its per pupil expenditure is $0.00?
Univariate Regression: SAT scores and Education Expenditures
Slope
For every one unit increase in per pupil expenditure, what happens to mean SAT scores?
Univariate Regression: SAT scores and Education Expenditures
Significance of individual predictors
Is there a statistically significant relationship between SAT scores and per pupil expenditures?
Univariate Regression: SAT scores and Education Expenditures
Significance of overall equation
Univariate Regression: SAT scores and Education Expenditures
Coefficient of determination
What percent of variation in SAT scores is explained by per pupil expense?
Univariate Regression: SAT scores and Education Expenditures
Standard error of the estimate
Linear Regression Assumptions
Assumption 1: Normal Distribution
The dependent variable is normally distributed
The errors of regression equation are normally distributed
Assumption 2: Homoscedasticity 
The variance around the regression line is the same for all values of the predictor variable (X)

Homoscedasticity
Regression Assumptions
Assumption 3: Errors are independent
The size of one error is not a function of the size of any previous error
Assumption 4: Relationships are linear
AKA – the relationship can be summarized with a straight line
Keep in mind that you can use alternative forms of regression to test non-linear relationships
Testing Assumptions: Normality
Testing Assumptions: Normality
swilk resid
Testing Assumptions: Homoscedasticity
Testing Assumptions: Homoscedasticity
Multiple Regression
Just keep adding predictors
regress dependent iv1 iv2 iv3…ivn
Let’s try adding some predictors to the model of SAT scores
Income (income), % students taking SATs (percent), % adults with HS diploma (high)
Multiple Regression
Correlations with Multiple Regression
Multiple Regression
Exercise 1: Multiple Regression
Multiple Regression: Interaction Terms
What if we wanted to test an interaction between percent & high?
Option 1:
generate a new variable
gen percenthigh = percent*high
Option 2:
Let Stata do your dirty work
Multiple Regression: Interaction Terms
Multiple Regression
Same rules apply for interpretation as with univariate regression
Slope, intercept, overall significance of the equation, R2, standard error of estimate
Can also generate residuals for assumption testing
Multiple Regression with Categorical Predictors
We can also test dichotomous and categorical predictors in our models
For categorical variables, we first need to dummy code
Use region as example
Dummy Coding
Dummy Coding
Option 1: Manually dummy code

tab region, gen(region)

gen region1=1 if region==1
gen region2=1 if region==2
gen region3=1 if region==3
gen region4=1 if region==4

NOTE: BE SURE TO CONSIDER MISSING DATA BEFORE GENERATING DUMMY VARIABLES

Option 2: Let Stata do your dirty work with “xi” command
Multiple Regression with Categorical Predictors
Regression, Categorical Predictors, & Interactions
Exercise 2: Regression, Categorical Predictors, & Interactions
Bonus Material!
How can I manage all this output?
Usually when we’re running regression, we’ll be testing multiple models at a time
Can be difficult to compare results
Stata offers several user-friendly options for storing and viewing regression output from multiple models
First, let’s download the necessary packages:
findit esttab
findit outreg2

How can I manage all this output?
You can both store output in Stata or ask Stata to export the results
First, let’s see how we can store this info in Stata:
regress csat expense income percent high
estimates store Model1
regress csat expense income percent high region2 /// region3 region4
estimates store Model2
How can I manage all this output?
Now Stata will hold your output in memory until you ask to recall it
esttab Model1 Model2
esttab Model1 Model2, label nostar


How can I manage all this output?
How can I manage all this output?
Outputting into Excel
Avoid human error when transferring coefficients into tables
regress csat expense income percent high
outreg2 using csatprediction.xls

Now, let’s add some options
regress csat expense income percent high
outreg2 using csatprediction.xls, bdec(3) ctitle(Model 1) ///
se title("Prediction of Average SAT scores") replace


How can I manage all this output?
What if my data are clustered?
Often, our data is grouped (by industry, schools, hospitals, etc.)
This grouping violates independence assumption of regression
Use “cluster” option as simple way to account for clustering and produce robust standard errors
DISCLAIMER: There are many ways to account for clustering in Stata and you should have a sound theoretical  model and understanding before applying cluster options
What if my data are clustered?
We’ll review a simple way to produce robust standard errors in a multiple regression, but also see:
http://www.ats.ucla.edu/stat/stata/faq/clusterreg.htm
Provides a complete description of various clustering options 
Select option that best fits your needs
What if my data are clustered?
