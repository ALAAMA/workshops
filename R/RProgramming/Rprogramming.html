<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-08 Wed 22:11 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Introduction To Programming In R</title>
<meta  name="generator" content="Org-mode" />
<link rel="stylesheet" type="text/css" href="http://tutorials.iq.harvard.edu/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://tutorials.iq.harvard.edu/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://tutorials.iq.harvard.edu/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Introduction To Programming In R</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline4">Workshop overview and materials</a>
<ul>
<li><a href="#orgheadline1">Workshop description</a></li>
<li><a href="#orgheadline2">Materials and setup</a></li>
<li><a href="#orgheadline3">Example project overview</a></li>
</ul>
</li>
<li><a href="#orgheadline5">Extracting elements from html</a>
<ul>
<li><a href="#orgheadline6">Packages for parsing html</a></li>
<li><a href="#orgheadline7">Extracting information from web pages with the <code>rvest</code> package</a></li>
<li><a href="#orgheadline8">Just the data please &#x2013; regular expressions to the rescue</a></li>
<li><a href="#orgheadline9">Getting the list of data links the easy way</a></li>
</ul>
</li>
<li><a href="#orgheadline10">Exercise 0: html parsing</a></li>
<li><a href="#orgheadline11">Exercise 0 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></a></li>
<li><a href="#orgheadline12">Downloading files in R</a></li>
<li><a href="#orgheadline13">Downloading all the files</a>
<ul>
<li><a href="#orgheadline14">Iterating using for-loop</a></li>
<li><a href="#orgheadline15">Iterating over vectors and lists with the <code>sapply</code> function</a></li>
<li><a href="#orgheadline16">Iterating in parallel with the <code>mclapply</code> function</a></li>
</ul>
</li>
<li><a href="#orgheadline17">Exercise 1: Iterate and extract</a></li>
<li><a href="#orgheadline18">Exercise 1 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></a></li>
<li><a href="#orgheadline19">Importing and inspecting data and meta-data</a>
<ul>
<li><a href="#orgheadline20">Mode and length</a></li>
<li><a href="#orgheadline21">Other properties of data.frames</a></li>
<li><a href="#orgheadline22">Additional attributes</a></li>
<li><a href="#orgheadline23">Extracting useful meta-data</a>
<ul>
<li><a href="#orgheadline24">Exercise 2</a></li>
<li><a href="#orgheadline25">Exercise 2 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline26">Aggregation</a></li>
<li><a href="#orgheadline27">Exercise 3</a></li>
<li><a href="#orgheadline28">Exercise 3 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></a></li>
<li><a href="#orgheadline29">Finishing touches</a>
<ul>
<li><a href="#orgheadline30">Data formatting</a></li>
<li><a href="#orgheadline31">Plotting</a></li>
</ul>
</li>
<li><a href="#orgheadline32">What else?</a></li>
<li><a href="#orgheadline33">Go forth and code!</a>
<ul>
<li><a href="#orgheadline34">Additional reading and resources</a></li>
<li><a href="#orgheadline35">Things that may surprise you</a>
<ul>
<li><a href="#orgheadline36">Floating point comparison</a></li>
<li><a href="#orgheadline37">Missing values</a></li>
<li><a href="#orgheadline38">Automatic type conversion</a></li>
<li><a href="#orgheadline39">Optional argument inconsistencies</a></li>
<li><a href="#orgheadline40">Trouble with Factors</a></li>
</ul>
</li>
<li><a href="#orgheadline41">Feedback</a></li>
</ul>
</li>
</ul>
</div>
</div>
<a class="github-fork-ribbon right-top" href="https://github.com/izahn/workshops" title="Fork me on GitHub">Fork me on GitHub</a>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">Workshop overview and materials</h2>
<div class="outline-text-2" id="text-orgheadline4">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1">Workshop description</h3>
<div class="outline-text-3" id="text-orgheadline1">
<p>
This is an intermediate/advanced R course appropriate for those with basic knowledge of R. It is intended for those already comfortable with using R for data analysis who wish to move on to writing their own functions. To the extent possible this workshop uses real-world examples. That is to say that concepts are introduced as they are needed for a realistic analysis task. In the course of working through a realistic project we will lean about interacting with web services, regular expressions, iteration, functions, control flow and more. 
</p>

<p>
Prerequisite: basic familiarity with R, such as acquired from an introductory R workshop.
</p>
</div>
</div>


<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">Materials and setup</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
Everyone should have R installed &#x2013; if not:
</p>

<ul class="org-ul">
<li>Open a web browser and go to <a href="http://cran.r-project.org/">http://cran.r-project.org/</a> and download and install it</li>
<li>Also helpful to install RStudio (download from <a href="http://rstudio.com/">http://rstudio.com/</a>)</li>
</ul>

<p>
Materials for this workshop include slides, example data sets, and example code.
</p>

<ul class="org-ul">
<li>Download materials from <a href="http://tutorials.iq.harvard.edu/R/RProgramming.zip">http://tutorials.iq.harvard.edu/R/RProgramming.zip</a></li>
<li>Extract the zip file containing the materials to your desktop</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">Example project overview</h3>
<div class="outline-text-3" id="text-orgheadline3">
<p>
Throughout this workshop we will return to a running example that involves acquiring, processing, and analyzing data from the <a href="http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/">Displaced Worker Survery</a> (DWS). In this context we will learn about finding and using R packages, importing and manipulating data, writing functions, and more. The web page has been mirrored at <a href="http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data">http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data</a> for convenience.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">Extracting elements from html</h2>
<div class="outline-text-2" id="text-orgheadline5">
<p>
It is common for data to be made available on a website somewhere, either by a government agency, research group, or other organizations and entities. Often the data you want is spread over many files, and retrieving it all one file at a time is tedious and time consuming. Such is the case with the CPS data we will be using today.
</p>

<p>
The Center for Economic and Policy Research has helpfully <a href="http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/">compiled DWS data going back to 1994</a><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>. Although we could open a web browser and download these files one at a time, it will be faster and easier to instruct R to do that for us. Doing it this way will also give us an excuse to talk about html parsing, regular expressions, package management, and other useful techniques.
</p>

<p>
Our goal is to download all the Stata data sets from <a href="http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/">http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/</a>. In order to do that we need a list of the Uniform Resource Locators (URLs) of those files. The URLs we need are right there as links in the ceprdata.org webpage. All we have to do is read that data in a way R can understand. 
</p>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Packages for parsing html</h3>
<div class="outline-text-3" id="text-orgheadline6">
<p>
In order extract the data URls from the ceprdata.org website we need a package for parsing XML and HTML. How do we find such a package?
</p>
<dl class="org-dl">
<dt>Task views</dt><dd><a href="https://cran.r-project.org/web/views/WebTechnologies.html">https://cran.r-project.org/web/views/WebTechnologies.html</a></dd>
<dt>R package search</dt><dd><a href="http://www.r-pkg.org/search.html?q=html+xml">http://www.r-pkg.org/search.html?q=html+xml</a></dd>
<dt>Web search</dt><dd><a href="https://www.google.com/search?q=R+parse+html+xml&amp;ie=utf-8&amp;oe=utf-8">https://www.google.com/search?q=R+parse+html+xml&amp;ie=utf-8&amp;oe=utf-8</a></dd>
</dl>

<p>
For parsing html in R I recommend either the <code>xml2</code> package or the <code>rvest</code> package, with the former being more flexible and the later being more user friendly. Let's use the friendlier one.
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">Extracting information from web pages with the <code>rvest</code> package</h3>
<div class="outline-text-3" id="text-orgheadline7">
<p>
Our first task is to read the web page into R. We can do that using the <code>read_html</code> function. Next we want to find all the links (the <code>&lt;a&gt;</code> tags) and extract their <code>href</code> attributes. To give a better sense of this here is what the html for the 2010 data file link looks like:
</p>
<pre class="example">
&lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_dws_2010_dta']);"
   href="/wp-content/cps/data/cepr_dws_2010_dta.zip"&gt;cepr_dws_2010_dta.zip&lt;/a&gt;
</pre>
<p>
We want the <code>href</code> part, i.e., "/wp-content/cps/data/cepr<sub>dws</sub><sub>2010</sub><sub>dta.zip</sub>".
</p>

<p>
We can get all the <code>&lt;a&gt;</code> elements using the <code>html_nodes</code> function, and then extract the <code>href</code> attributes usig the <code>html_attr</code> function, like this:
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">install.packages("rvest")</span>
<span class="org-constant">library</span>(rvest)

<span class="org-comment-delimiter">## </span><span class="org-comment">read the web page into R</span>
dataPage <span class="org-constant">&lt;-</span> read_html(<span class="org-string">"http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/"</span>)

<span class="org-comment-delimiter">## </span><span class="org-comment">find the link ("a") elements.</span>
allAnchors <span class="org-constant">&lt;-</span> html_nodes(dataPage, <span class="org-string">"a"</span>)
head(allAnchors, <span class="org-highlight-numbers-number">15</span>)

<span class="org-comment-delimiter">## </span><span class="org-comment">extract the link ("href") attributes</span>
allLinks <span class="org-constant">&lt;-</span> html_attr(allAnchors, <span class="org-string">"href"</span>)
head(allLinks, <span class="org-highlight-numbers-number">15</span>)
</pre>
</div>

<pre class="example">
&gt; ## install.packages("rvest")
&gt; library(rvest)
&gt; 
&gt; ## read the web page into R
&gt; dataPage &lt;- read_html("http://tutorials.iq.harvard.edu/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/")
&gt; 
&gt; ## find the link ("a") elements.
&gt; allAnchors &lt;- html_nodes(dataPage, "a")
&gt; head(allAnchors, 15)
{xml_nodeset (15)}
 [1] &lt;a href="http://ceprdata.org/" title="Home" rel="home"&gt;\n  &lt;img src="http://s4 ...
 [2] &lt;a href="http://ceprdata.org/wp-login.php"&gt;Log in&lt;/a&gt;
 [3] &lt;a href="http://www.ceprdata.org"&gt;Home&lt;/a&gt;
 [4] &lt;a href="http://ceprdata.org/cps-uniform-data-extracts/"&gt;CPS&lt;/a&gt;
 [5] &lt;a href="http://ceprdata.org/sipp-uniform-data-extracts/"&gt;SIPP&lt;/a&gt;
 [6] &lt;a href="http://ceprdata.org/acs-uniform-data-extracts/"&gt;ACS&lt;/a&gt;
 [7] &lt;a href="http://ceprdata.org/other-data/"&gt;Other Data&lt;/a&gt;
 [8] &lt;a href="http://ceprdata.org/publications/"&gt;Publications&lt;/a&gt;
 [9] &lt;a href="http://ceprdata.org/contact/"&gt;Contact&lt;/a&gt;
[10] &lt;a href="https://org.salsalabs.com/o/967/p/salsa/donation/common/public/?donat ...
[11] &lt;a rel="bookmark" href="http://ceprdata.org/cps-uniform-data-extracts/cps-disp ...
[12] &lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_dws_2010_dta']) ...
[13] &lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_dws_2008_dta']) ...
[14] &lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_dws_2006_dta']) ...
[15] &lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_dws_2004_dta']) ...
&gt; 
&gt; ## extract the link ("href") attributes
&gt; allLinks &lt;- html_attr(allAnchors, "href")
&gt; head(allLinks, 15)
 [1] "http://ceprdata.org/"                                                                   
 [2] "http://ceprdata.org/wp-login.php"                                                       
 [3] "http://www.ceprdata.org"                                                                
 [4] "http://ceprdata.org/cps-uniform-data-extracts/"                                         
 [5] "http://ceprdata.org/sipp-uniform-data-extracts/"                                        
 [6] "http://ceprdata.org/acs-uniform-data-extracts/"                                         
 [7] "http://ceprdata.org/other-data/"                                                        
 [8] "http://ceprdata.org/publications/"                                                      
 [9] "http://ceprdata.org/contact/"                                                           
[10] "https://org.salsalabs.com/o/967/p/salsa/donation/common/public/?donate_page_KEY=1809"   
[11] "http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-data/"
[12] "/wp-content/cps/data/cepr_dws_2010_dta.zip"                                             
[13] "/wp-content/cps/data/cepr_dws_2008_dta.zip"                                             
[14] "/wp-content/cps/data/cepr_dws_2006_dta.zip"                                             
[15] "/wp-content/cps/data/cepr_dws_2004_dta.zip"                                             
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">Just the data please &#x2013; regular expressions to the rescue</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
Looking at the output from the previous example you might notice a problem; we've matched <span class="underline">all</span> the URLs on the web page. Some of those (the ones that end in .zip) are the ones we want, others are menu links that we don't want. How can we separate the data links from the other links on the page?
</p>

<p>
One answer is to use regular expressions to idenfify the links we want. Regular expressions are useful in general (not just in R!) and it is a good idea to be familiar with at least the basics. For our present purpose it will be more than enough to use regular expression that matches strings starting with <code>/wp</code> and ending with <code>.zip</code>.
</p>

<p>
In regulars expression <code>^</code>, <code>.</code>, <code>*</code>, and <code>$</code> are special characters with the following meanings:
</p>
<dl class="org-dl">
<dt>^</dt><dd>matches the beginning of the string</dd>
<dt>.</dt><dd>matches any character</dd>
<dt>*</dt><dd>repeates the last caracter zero or more times</dd>
<dt>$</dt><dd>matches the end of the string</dd>
</dl>

<p>
If you have not been introduced to regular expressions yet a nice interactive regex tester is available at <a href="http://www.regexr.com/">http://www.regexr.com/</a> and an interactive tutorial is available at <a href="http://www.regexone.com/">http://www.regexone.com/</a>.
</p>

<p>
R comes with a <code>grep</code> function that can be used to search for patterns in strings, but for more sophisticated string manipulation I recommend the <code>stringi</code> package. The function names are more verbose, but it provides much more complete and robust string handling than is available in base R. For our relatively simple needs <code>grep</code> will suffice, but if you need to do extensive string manipulation in R the <code>stringi</code> package is the way to go.
</p>

<div class="org-src-container">

<pre class="src src-R">dataLinks <span class="org-constant">&lt;-</span> grep(<span class="org-string">"^/wp.*\\.zip$"</span>, allLinks, value = <span class="org-type">TRUE</span>)
head(dataLinks)
</pre>
</div>

<pre class="example">
&gt; dataLinks &lt;- grep("^/wp.*\\.zip$", allLinks, value = TRUE)
&gt; head(dataLinks)
[1] "/wp-content/cps/data/cepr_dws_2010_dta.zip"
[2] "/wp-content/cps/data/cepr_dws_2008_dta.zip"
[3] "/wp-content/cps/data/cepr_dws_2006_dta.zip"
[4] "/wp-content/cps/data/cepr_dws_2004_dta.zip"
[5] "/wp-content/cps/data/cepr_dws_2002_dta.zip"
[6] "/wp-content/cps/data/cepr_dws_2000_dta.zip"
&gt;
</pre>

<p>
(Note that the backslashes in the above example are used to escape the <code>.</code> so that it is matched literally instead of matching any characters as it normallly would in a regular expression.)
</p>

<p>
Finally, the data links we've extracted are relative to the ceprdata website. To make them valid we need to prepend <code>http://tutorials.iq.harvard.edu/</code> to each one. We can do that using the <code>paste</code> function.
</p>
<div class="org-src-container">

<pre class="src src-R">dataLinks <span class="org-constant">&lt;-</span> paste(<span class="org-string">"http://tutorials.iq.harvard.edu"</span>, dataLinks, sep = <span class="org-string">""</span>)
head(dataLinks)
</pre>
</div>

<pre class="example">
&gt; dataLinks &lt;- paste("http://tutorials.iq.harvard.edu", dataLinks, sep = "")
&gt; head(dataLinks)
[1] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2010_dta.zip"
[2] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2008_dta.zip"
[3] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2006_dta.zip"
[4] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2004_dta.zip"
[5] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2002_dta.zip"
[6] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2000_dta.zip"
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9">Getting the list of data links the easy way</h3>
<div class="outline-text-3" id="text-orgheadline9">
<p>
If you look at the result from the previous two methods you might notice that the URLs are all the same save for the year number. This suggests an even easier way to construct the list of URLs:
</p>
<div class="org-src-container">

<pre class="src src-R">(dataLinks <span class="org-constant">&lt;-</span> paste(<span class="org-string">"http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_"</span>,
                    seq(<span class="org-highlight-numbers-number">1994</span>, <span class="org-highlight-numbers-number">2010</span>, by = <span class="org-highlight-numbers-number">2</span>),
                    <span class="org-string">"_dta.zip"</span>,
                    sep = <span class="org-string">""</span>))
</pre>
</div>

<pre class="example">
&gt; (dataLinks &lt;- paste("http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_",
+                     seq(1994, 2010, by = 2),
+                     "_dta.zip",
+                     sep = ""))
[1] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_1994_dta.zip"
[2] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_1996_dta.zip"
[3] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_1998_dta.zip"
[4] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2000_dta.zip"
[5] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2002_dta.zip"
[6] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2004_dta.zip"
[7] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2006_dta.zip"
[8] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2008_dta.zip"
[9] "http://tutorials.iq.harvard.edu/wp-content/cps/data/cepr_dws_2010_dta.zip"
&gt;
</pre>

<p>
Wow, that was a <span class="underline">lot</span> easier. Why oh why didn't we just do that in the first place? Well, it works for this specific case, but it is much less general than the html parsing methods we discussed previously. Those methods will work in the general case, while pasting the year number into the URLs only works because the URLs we want have a very regular and consistent form.
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10">Exercise 0: html parsing</h2>
<div class="outline-text-2" id="text-orgheadline10">
<p>
The <a href="http://ceprdata.org/">http://ceprdata.org/</a> website provides code books for the DWS data in <code>.pdf</code> format. Links to these code books are available on the documentation page at <a href="http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-documentation/">http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-documentation/</a>. Parse this page and extract the links to the code books.
</p>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11">Exercise 0 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></h2>
<div class="outline-text-2" id="text-orgheadline11">
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">read in the html page</span>
ceprDoc <span class="org-constant">&lt;-</span> read_html(
  <span class="org-string">"http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-documentation/"</span>
)
<span class="org-comment-delimiter">## </span><span class="org-comment">get the codebook links</span>
ceprCodeBookLinks <span class="org-constant">&lt;-</span> html_attr(<span class="org-comment-delimiter">#</span><span class="org-comment">extract attributes</span>
  html_nodes(<span class="org-comment-delimiter">#</span><span class="org-comment">from nodes  </span>
    ceprDoc,<span class="org-comment-delimiter">#</span><span class="org-comment">in ceprDoc</span>
    <span class="org-comment-delimiter">## </span><span class="org-comment">This uses an xpath expression to select just the codebook links.</span>
    <span class="org-comment-delimiter">## </span><span class="org-comment">You could alternatively download all the links and filter them</span>
    <span class="org-comment-delimiter">## </span><span class="org-comment">with a regular expression. Use whatever works and is comfortable!</span>
    <span class="org-comment-delimiter">## </span><span class="org-comment">There is more than one right way.</span>
    xpath = <span class="org-string">'//*[@id="content"]/article/div/ul[1]//a'</span>),<span class="org-comment-delimiter">#</span><span class="org-comment">matching this xpath</span>
  <span class="org-string">'href'</span> <span class="org-comment-delimiter">#</span><span class="org-comment">extract href attributes</span>
)
</pre>
</div>

<pre class="example">
&gt; ## read in the html page
&gt; ceprDoc &lt;- read_html(
+   "http://ceprdata.org/cps-uniform-data-extracts/cps-displaced-worker-survey/cps-dws-documentation/"
+ )
&gt; ## get the codebook links
&gt; ceprCodeBookLinks &lt;- html_attr(#extract attributes
+   html_nodes(#from nodes  
+     ceprDoc,#in ceprDoc
+     ## This uses an xpath expression to select just the codebook links.
+     ## You could alternatively download all the links and filter them
+     ## with a regular expression. Use whatever works and is comfortable!
+     ## There is more than one right way.
+     xpath = '//*[@id="content"]/article/div/ul[1]//a'),#matching this xpath
+   'href' #extract href attributes
+ )
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12">Downloading files in R</h2>
<div class="outline-text-2" id="text-orgheadline12">
<p>
Now that we have a vector of URLs pointing to the data files we want to download, we want to iterate over the elements and download each file. We can use the <code>download.file</code> function to download the data files. 
</p>

<p>
The <code>download.file</code> function requires a URL as the first argument, and a file name as the second argument. We can use the <code>basename</code> function to strip of the location part of the URL, leaving only the file name. We could do this verbosely by writing one line for each file:
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">download.file(dataLinks[1], basename(dataLinks[1]))</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">download.file(dataLinks[2], basename(dataLinks[2]))</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">...</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">download.file(dataLinks[n], basename(dataLinks[3]))</span>
</pre>
</div>
<p>
but that is too much typing. First, it would be more convenient if the <code>download.file</code> function defaulted to <code>destfile = basename(url)</code>. Fortunately it is very easy to write your own functions in R. We can write a wrapper around the <code>download.file</code> function like this:
</p>

<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">a simple function to make downloading files easier</span>
<span class="org-function-name">downloadFile</span> <span class="org-constant">&lt;-</span> <span class="org-keyword">function</span>(url, <span class="org-comment-delimiter"># </span><span class="org-comment">url to download</span>
                         destfile = basename(url), <span class="org-comment-delimiter"># </span><span class="org-comment">default name to save to</span>
                         outdir = <span class="org-string">"./dataSets/"</span>, <span class="org-comment-delimiter"># </span><span class="org-comment">default directory to save in</span>
                         ... <span class="org-comment-delimiter"># </span><span class="org-comment">other named arguments passed to download.file</span>
                         ){
  <span class="org-comment-delimiter">## </span><span class="org-comment">create output directory if it doesn't exist</span>
  <span class="org-keyword">if</span>(!dir.exists(outdir)) {
    dir.create(outdir)
  }
  <span class="org-comment-delimiter">## </span><span class="org-comment">download the file using the specified url, output directory, and file name</span>
  download.file(url = url, destfile = paste(outdir, destfile, sep = <span class="org-string">""</span>), ...)
}
</pre>
</div>

<p>
Using this function we can download the data files more conveniently, but we haven't yet addressed how to avoid typing out separate function calls for each file we need to download. For that we need iteration.
</p>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13">Downloading all the files</h2>
<div class="outline-text-2" id="text-orgheadline13">
<p>
To download all the files conveniently we want to iterate over the vector of URLs and download each one. We can carry out this iteration in several ways, including using a <code>for</code> loop, or using one of the <code>apply</code> family of functions.
</p>

<p>
<code>for</code> and <code>while</code> loops in R work much the same as they do in other programming languages. The <code>apply</code> family of functions apply a function to each element of an object.
</p>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">Iterating using for-loop</h3>
<div class="outline-text-3" id="text-orgheadline14">
<p>
One way to download the data files is to use a for-loop to iterate over the contents of our vector of URLs. Some people will tell you to avoid for-loops in R but this is nonsense. Loops are convenient and useful, and while they are not the best tool for all situations calling for iteration they are perfectly appropriate for downloading a series of files. If you've used a for loop in any other language you will probably find the R implementation to be very similar.
</p>

<p>
For loops in R have the following general structure:
<code>for(&lt;placeholder&gt; in &lt;thing to iterate over&gt;) {do stuff with placeholder}</code>. In our case we want to iterate over <code>dataLinks</code> and download each one, so this becomes
</p>
<div class="org-src-container">

<pre class="src src-R">str(dataLinks)

<span class="org-comment-delimiter">## </span><span class="org-comment">make a directory to store the data</span>
dir.create(<span class="org-string">"dataSets"</span>)

<span class="org-keyword">for</span>(link <span class="org-keyword">in</span> dataLinks) {
    downloadFile(link, outdir = <span class="org-string">"dataSets/"</span>)
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15">Iterating over vectors and lists with the <code>sapply</code> function</h3>
<div class="outline-text-3" id="text-orgheadline15">
<p>
The <code>sapply</code> function iterates over a vector or list and applies a function to each element. To start, let's use <code>sapply</code> do download all the displaced worker survey data files:
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">download all the dws data</span>
sapply(dataLinks,
       downloadFile,
       outdir = <span class="org-string">"dataSets/"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16">Iterating in parallel with the <code>mclapply</code> function</h3>
<div class="outline-text-3" id="text-orgheadline16">
<p>
The <code>mclapply</code> function iterates over a vector or list and applies a function to each element using multiple CPU cores (where available). Let's use <code>mclapply</code> do download all the displaced worker survey data files:
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">download all the dws data</span>
<span class="org-constant">library</span>(parallel)
mclapply(dataLinks,
       downloadFile,
       outdir = <span class="org-string">"dataSets/"</span>,
       mc.cores = detectCores())
</pre>
</div>



<p>
We can now use what we've learned about iteration to unzip all the files in the <code>dataSets</code> directory, a task I leave to you.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-2">
<h2 id="orgheadline17">Exercise 1: Iterate and extract</h2>
<div class="outline-text-2" id="text-orgheadline17">
<p>
Use a <code>for</code> loop or <code>*apply</code> function to unzip each of the <code>.zip</code> files in the <code>dataSets</code> directory.
</p>

<p>
BONUS (optional): calculate the size of each extracted file and calculate the difference in size between each <code>.dta</code> file and the <code>.zip</code> file it was extracted from.
</p>
</div>
</div>
<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18">Exercise 1 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></h2>
<div class="outline-text-2" id="text-orgheadline18">
<div class="org-src-container">

<pre class="src src-R">zipFiles <span class="org-constant">&lt;-</span> list.files(<span class="org-string">"dataSets"</span>, pattern = <span class="org-string">"\\.zip$"</span>, full.names=<span class="org-type">TRUE</span>)

<span class="org-comment-delimiter">## </span><span class="org-comment">using sapply</span>
sapply(zipFiles, unzip, exdir = <span class="org-string">"dataSets"</span>)
<span class="org-comment-delimiter">## </span><span class="org-comment">using a for loop</span>
<span class="org-keyword">for</span>(f <span class="org-keyword">in</span> zipFiles) unzip(f, exdir = <span class="org-string">"dataSets"</span>)

<span class="org-comment-delimiter">## </span><span class="org-comment">Calculating compression ratios</span>
dataFiles <span class="org-constant">&lt;-</span> list.files(<span class="org-string">"dataSets"</span>, pattern = <span class="org-string">"\\.dta$"</span>, full.names = <span class="org-type">TRUE</span>)

uncompSize <span class="org-constant">&lt;-</span> round(file.size(dataFiles) / <span class="org-highlight-numbers-number">1024</span>^<span class="org-highlight-numbers-number">2</span>)
compSize <span class="org-constant">&lt;-</span> round(file.size(zipFiles) / <span class="org-highlight-numbers-number">1024</span>^<span class="org-highlight-numbers-number">2</span>)

cbind(zipFile = paste0(basename(zipFiles), <span class="org-string">": "</span>, compSize, <span class="org-string">"Mb"</span>),
      dtaFile = paste0(basename(dataFiles), <span class="org-string">": "</span>, uncompSize, <span class="org-string">"Mb"</span>),
      diff = paste0(round(uncompSize - compSize), <span class="org-string">"Mb"</span>),
      compression_ratio = round(uncompSize / compSize, digits = <span class="org-highlight-numbers-number">3</span>))
</pre>
</div>

<pre class="example">
&gt; zipFiles &lt;- list.files("dataSets", pattern = "\\.zip$", full.names=TRUE)
&gt; 
&gt; ## using sapply
&gt; sapply(zipFiles, unzip, exdir = "dataSets")
dataSets/cepr_dws_1994_dta.zip dataSets/cepr_dws_1996_dta.zip 
  "dataSets/cepr_dws_1994.dta"   "dataSets/cepr_dws_1996.dta" 
dataSets/cepr_dws_1998_dta.zip dataSets/cepr_dws_2000_dta.zip 
  "dataSets/cepr_dws_1998.dta"   "dataSets/cepr_dws_2000.dta" 
dataSets/cepr_dws_2002_dta.zip dataSets/cepr_dws_2004_dta.zip 
  "dataSets/cepr_dws_2002.dta"   "dataSets/cepr_dws_2004.dta" 
dataSets/cepr_dws_2006_dta.zip dataSets/cepr_dws_2008_dta.zip 
  "dataSets/cepr_dws_2006.dta"   "dataSets/cepr_dws_2008.dta" 
dataSets/cepr_dws_2010_dta.zip 
  "dataSets/cepr_dws_2010.dta" 
&gt; ## using a for loop
&gt; for(f in zipFiles) unzip(f, exdir = "dataSets")
&gt; 
&gt; ## Calculating compression ratios
&gt; dataFiles &lt;- list.files("dataSets", pattern = "\\.dta$", full.names = TRUE)
&gt; 
&gt; uncompSize &lt;- round(file.size(dataFiles) / 1024^2)
&gt; compSize &lt;- round(file.size(zipFiles) / 1024^2)
&gt; 
&gt; cbind(zipFile = paste0(basename(zipFiles), ": ", compSize, "Mb"),
+       dtaFile = paste0(basename(dataFiles), ": ", uncompSize, "Mb"),
+       diff = paste0(round(uncompSize - compSize), "Mb"),
+       compression_ratio = round(uncompSize / compSize, digits = 3))
      zipFile                      dtaFile                   diff   compression_ratio
 [1,] "cepr_dws_1994_dta.zip: 5Mb" "cepr_dws_1994.dta: 35Mb" "30Mb" "7"              
 [2,] "cepr_dws_1996_dta.zip: 4Mb" "cepr_dws_1996.dta: 31Mb" "27Mb" "7.75"           
 [3,] "cepr_dws_1998_dta.zip: 4Mb" "cepr_dws_1998.dta: 31Mb" "27Mb" "7.75"           
 [4,] "cepr_dws_2000_dta.zip: 4Mb" "cepr_dws_2000.dta: 31Mb" "27Mb" "7.75"           
 [5,] "cepr_dws_2002_dta.zip: 5Mb" "cepr_dws_2002.dta: 40Mb" "35Mb" "8"              
 [6,] "cepr_dws_2004_dta.zip: 5Mb" "cepr_dws_2004.dta: 39Mb" "34Mb" "7.8"            
 [7,] "cepr_dws_2006_dta.zip: 5Mb" "cepr_dws_2006.dta: 39Mb" "34Mb" "7.8"            
 [8,] "cepr_dws_2008_dta.zip: 5Mb" "cepr_dws_2008.dta: 39Mb" "34Mb" "7.8"            
 [9,] "cepr_dws_2010_dta.zip: 5Mb" "cepr_dws_2010.dta: 39Mb" "34Mb" "7.8"            
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19">Importing and inspecting data and meta-data</h2>
<div class="outline-text-2" id="text-orgheadline19">
<p>
Our next goal is to read in the data that we downloaded and extracted earlier. The data are stored as Stata data sets, which can be imported using the <code>read.dta</code> function in the <code>foreign</code> package. Let's start by reading just the first data set.
</p>

<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">attach the foreign packge so we can read stata files</span>
<span class="org-constant">library</span>(foreign)

<span class="org-comment-delimiter">## </span><span class="org-comment">get a list of all the stata files in the dataSets directory</span>
dataFiles <span class="org-constant">&lt;-</span> list.files(<span class="org-string">"dataSets"</span>, pattern = <span class="org-string">"\\.dta$"</span>, full.names=<span class="org-type">TRUE</span>)

<span class="org-comment-delimiter">## </span><span class="org-comment">read in the first one</span>
ceprData1 <span class="org-constant">&lt;-</span> read.dta(dataFiles[<span class="org-highlight-numbers-number">1</span>])
</pre>
</div>

<p>
Now that we've read in some of the data we want to get some more information about it. 
</p>
</div>

<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20">Mode and length</h3>
<div class="outline-text-3" id="text-orgheadline20">
<p>
Information about objects in R are stored as <i>attributes</i> of the object. All R objects have a storage <i>mode</i> and a <i>length</i>. Since all objects in R have these attributes we refer to them as <i>intrinsic attributes</i>. We can get the value of these intrinsic attributes using the <code>mode</code> and <code>length</code> functions respecively. For example, what is the mode and length of our <code>ceprData1</code> object?
</p>
<div class="org-src-container">

<pre class="src src-R">mode(ceprData1)
length(ceprData1)
</pre>
</div>

<pre class="example">
&gt; mode(ceprData1)
[1] "list"
&gt; length(ceprData1)
[1] 178
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21">Other properties of data.frames</h3>
<div class="outline-text-3" id="text-orgheadline21">
<p>
So far we've seen that <code>ceprData1</code> is a list of length 178. Actually <code>ceprData1</code> is a special kind of list called a <code>data.frame</code>. We can see that by asking R what the <code>class</code> of the object is.
</p>
<div class="org-src-container">

<pre class="src src-R">class(ceprData1)
</pre>
</div>

<pre class="example">
&gt; class(ceprData1)
[1] "data.frame"
&gt;
</pre>

<p>
A <i>data.frame</i> in R is a list with elements of equal length. It is a rectangular structure with rows and columns. In addition to the <i>mode</i> and <i>length</i> that all object in R have, <i>data.frames</i> also have dimension, (col)names, and =rownames.
</p>
<div class="org-src-container">

<pre class="src src-R">dim(ceprData1)
names(ceprData1)
c(head(rownames(ceprData1)), <span class="org-string">"..."</span>, tail(rownames(ceprData1)))
</pre>
</div>

<pre class="example">
&gt; dim(ceprData1)
[1] 156246    178
&gt; names(ceprData1)
  [1] "year"      "indws"     "dw_stat"   "dwswgt"    "dw"        "dw_bls"   
  [7] "dw_why"    "dw_when"   "xrecall"   "notice"    "not_when"  "ljten"    
 [13] "ljtenr"    "uibens"    "uiended"   "moved"     "movedec"   "worked"   
 [19] "wkswo"     "numjobs"   "ljcowd"    "ljcow"     "ljindd94"  "ljindd04" 
 [25] "ljind94"   "ljind04"   "ljagric"   "ljmanuf"   "ljservs"   "ljconstr" 
 [31] "ljrwtrade" "ljfire"    "ljoccd94"  "ljoccd04"  "ljocc94"   "ljunion"  
 [37] "ljhealth"  "hi_now"    "ljft"      "ljhv"      "cjftcps"   "cjhvcps"  
 [43] "ljpayper"  "ljot"      "ljwage"    "ljwagetc"  "ljhours"   "ljwkot"   
 [49] "ljottc"    "ljothrs"   "ljwktc"    "ljwkpay"   "ljweeks"   "ljpayr"   
 [55] "cjppdws"   "cjpporg"   "cjpayper"  "cjhr_dws"  "cjhr_org"  "cjhrly"   
 [61] "cjot_dws"  "cjot_org"  "cjot"      "cjw_dws"   "cjw_org"   "cjwage"   
 [67] "cjwdwstc"  "cjworgtc"  "cjw_tc"    "cjh_dws"   "cjh_org"   "cjhours"  
 [73] "cjotadws"  "cjotaorg"  "cjotamt"   "cjottcd"   "cjottco"   "cjottc"   
 [79] "cjothrd"   "cjwtcdws"  "cjwtcorg"  "cjwtc"     "cjwpdws"   "cjwporg"  
 [85] "cjwkpay"   "cjwk_dws"  "cjwk_cps"  "cjweeks"   "cjpayorg"  "cjpayr"   
 [91] "month"     "minsamp"   "hhid"      "hhnum"     "hrlonglk"  "lineno"   
 [97] "fnlwgt"    "orgwgt"    "lonwgt"    "famwgt"    "age"       "female"   
[103] "wbho"      "forborn"   "citizen"   "prcitshp"  "penatvty"  "pemntvty" 
[109] "pefntvty"  "prinusyr"  "arrived"   "vet"       "married"   "ownchild" 
[115] "ch02"      "ch05"      "ch35"      "ch613"     "ch1417"    "famrel84" 
[121] "famrel94"  "faminc"    "lfstat"    "empl"      "unem"      "nilf"     
[127] "selfemp"   "selfinc"   "pubsect"   "pubfed"    "pubst"     "publoc"   
[133] "unmem"     "uncov"     "union"     "student"   "studpt"    "state"    
[139] "metro"     "centcity"  "suburb"    "rural"     "educ"      "ind_nber" 
[145] "ind_2d"    "ind70"     "ind80"     "ind03"     "agric"     "manuf"    
[151] "servs"     "constr"    "rwtrade"   "fire"      "docc70"    "docc80"   
[157] "docc03"    "occ70"     "occ80"     "occ03"     "manag83"   "manag03"  
[163] "hourslw"   "reason94"  "absent94"  "uhourse"   "ptecon"    "unempt"   
[169] "prhrusl"   "pehrusl1"  "pehrusl2"  "pehruslt"  "peernhro"  "imphrs"   
[175] "hrsimptd"  "hrernhr"   "uhoursi"   "blsimpt"  
&gt; c(head(rownames(ceprData1)), "...", tail(rownames(ceprData1)))
 [1] "1"      "2"      "3"      "4"      "5"      "6"      "..."    "156241" "156242"
[10] "156243" "156244" "156245" "156246"
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22">Additional attributes</h3>
<div class="outline-text-3" id="text-orgheadline22">
<p>
OK, so far we know the ceprData1 is a <i>data.frame</i> with 156246 rows and 178 columns, and that the variables have terrible cryptic names like <code>cjpporg</code> and <code>ljagric</code>. What do we actually have here? One way to answer the question is
</p>
<div class="org-src-container">

<pre class="src src-R">browseURL(ceprCodeBookLinks[<span class="org-highlight-numbers-number">1</span>])
</pre>
</div>
<p>
and that is a good answer actually. In our case the meta-data has also been embedded in the <code>.dta</code> files by our friends at <a href="http://ceprdata.org/">ceprdata.org</a>. This meta-data has been attached to the <code>ceprData1</code> data.frame in the form of additional attributes. 
</p>

<p>
The system used by R for storing attributes of this kind is simple. Arbitrary attributes can be set using the <code>attr</code> function, and retrieved using either <code>attr</code> or the <code>attributes</code> function. Let's take a quick look a this system before using it to access the ceprData1 meta-data.
</p>

<div class="org-src-container">

<pre class="src src-R">x <span class="org-constant">&lt;-</span> <span class="org-highlight-numbers-number">1:10</span>
attributes(x)
attr(x, <span class="org-string">"description"</span>) <span class="org-constant">&lt;-</span> <span class="org-string">"This is vector of integers from 1 to 10"</span>
attributes(x)
attr(x, <span class="org-string">"how_many"</span>) <span class="org-constant">&lt;-</span> <span class="org-string">"There are ten things in this vector"</span>
attributes(x)
attr(x, <span class="org-string">"description"</span>)
</pre>
</div>

<pre class="example">
&gt; x &lt;- 1:10
&gt; attributes(x)
NULL
&gt; attr(x, "description") &lt;- "This is vector of integers from 1 to 10"
&gt; attributes(x)
$description
[1] "This is vector of integers from 1 to 10"

&gt; attr(x, "how_many") &lt;- "There are ten things in this vector"
&gt; attributes(x)
$description
[1] "This is vector of integers from 1 to 10"

$how_many
[1] "There are ten things in this vector"

&gt; attr(x, "description")
[1] "This is vector of integers from 1 to 10"
&gt;
</pre>


<p>
As we've seen, additional attributes and be accessed vie the <code>attributes</code> function. Let's see what other attributes our <code>ceprData</code> object has.
</p>
<div class="org-src-container">

<pre class="src src-R">ceprDataInfo <span class="org-constant">&lt;-</span> attributes(ceprData1)
mode(ceprDataInfo)
class(ceprDataInfo)
length(ceprDataInfo)
names(ceprDataInfo)
</pre>
</div>

<pre class="example">
&gt; ceprDataInfo &lt;- attributes(ceprData1)
&gt; mode(ceprDataInfo)
[1] "list"
&gt; class(ceprDataInfo)
[1] "list"
&gt; length(ceprDataInfo)
[1] 12
&gt; names(ceprDataInfo)
 [1] "datalabel"        "time.stamp"       "names"            "formats"         
 [5] "types"            "val.labels"       "var.labels"       "expansion.fields"
 [9] "row.names"        "version"          "label.table"      "class"           
&gt;
</pre>

<p>
Let's iterate over the attributes of =ceprData1- and get some more information about the available meta-data
</p>
<div class="org-src-container">

<pre class="src src-R">t(sapply(attributes(ceprData1),
         <span class="org-keyword">function</span>(x) {
           c(mode = mode(x), class = class(x), length = length(x))
         })
  )
</pre>
</div>

<pre class="example">
&gt; t(sapply(attributes(ceprData1),
+          function(x) {
+            c(mode = mode(x), class = class(x), length = length(x))
+          })
+   )
                 mode        class       length  
datalabel        "character" "character" "1"     
time.stamp       "character" "character" "1"     
names            "character" "character" "178"   
formats          "character" "character" "178"   
types            "numeric"   "integer"   "178"   
val.labels       "character" "character" "178"   
var.labels       "character" "character" "178"   
expansion.fields "list"      "list"      "525"   
row.names        "character" "character" "156246"
version          "numeric"   "integer"   "1"     
label.table      "list"      "list"      "30"    
class            "character" "character" "1"     
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23">Extracting useful meta-data</h3>
<div class="outline-text-3" id="text-orgheadline23">
<p>
We can extract elements from lists in a few different ways:
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">extract by name</span>
ceprDataInfo$datalabel <span class="org-comment-delimiter">#</span><span class="org-comment">using $</span>
ceprDataInfo[<span class="org-string">"datalabel"</span>] <span class="org-comment-delimiter">#</span><span class="org-comment">using [</span>
ceprDataInfo[[<span class="org-string">"datalabel"</span>]] <span class="org-comment-delimiter">#</span><span class="org-comment">using [[, note the difference</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">by position</span>
ceprDataInfo[<span class="org-highlight-numbers-number">1</span>]; ceprDataInfo[[<span class="org-highlight-numbers-number">1</span>]] <span class="org-comment-delimiter"># </span><span class="org-comment">note the difference</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">by logical index</span>
ceprDataInfo[c(<span class="org-type">TRUE</span>, <span class="org-type">TRUE</span>, rep(<span class="org-type">FALSE</span>, <span class="org-highlight-numbers-number">10</span>))]
ceprDataInfo[sapply(ceprDataInfo, length) == <span class="org-highlight-numbers-number">1</span>]
</pre>
</div>

<pre class="example">
&gt; ## extract by name
&gt; ceprDataInfo$datalabel #using $
[1] "CEPR DWS Extract, Version 1.01, 1994"
&gt; ceprDataInfo["datalabel"] #using [
$datalabel
[1] "CEPR DWS Extract, Version 1.01, 1994"

&gt; ceprDataInfo[["datalabel"]] #using [[, note the difference
[1] "CEPR DWS Extract, Version 1.01, 1994"
&gt; 
&gt; ## by position
&gt; ceprDataInfo[1]; ceprDataInfo[[1]] # note the difference
$datalabel
[1] "CEPR DWS Extract, Version 1.01, 1994"

[1] "CEPR DWS Extract, Version 1.01, 1994"
&gt; 
&gt; ## by logical index
&gt; ceprDataInfo[c(TRUE, TRUE, rep(FALSE, 10))]
$datalabel
[1] "CEPR DWS Extract, Version 1.01, 1994"

$time.stamp
[1] "17 Feb 2011 18:18"

&gt; ceprDataInfo[sapply(ceprDataInfo, length) == 1]
$datalabel
[1] "CEPR DWS Extract, Version 1.01, 1994"

$time.stamp
[1] "17 Feb 2011 18:18"

$version
[1] 8

$class
[1] "data.frame"

&gt;
</pre>

<p>
Note that <code>[</code> indexing on a list returns a list, and <code>[[</code> indexing returns whatever contained in a single element of the list. This visual explanation may help: 
<img src="images/HadleyWickham_index_list.png" alt="HadleyWickham_index_list.png" /><sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>
</p>

<p>
You may have noticed during our earlier investigation of <code>ceprDataInfo</code> that many of the elements have length 178. That number might be familiar:
</p>
<div class="org-src-container">

<pre class="src src-R">dim(ceprData1)
</pre>
</div>

<p>
it's the number of columns in the data set. It is therefor a good guess that those elements record information about each of the columns in the data set. 
</p>
</div>

<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24">Exercise 2</h4>
<div class="outline-text-4" id="text-orgheadline24">
<p>
Extract elements from <code>ceprDataInfo</code> that will help you understand what each column in <code>deprData</code> contains. Include at least the variable <code>names</code> and <code>var.labels</code> as well as any other information that you think will be useful.
</p>

<p>
Bonus (optional): supplement the <code>ceprDataInfo</code> you extracted in step one with the mode, class, etc. of each column in <code>ceprData1</code> 
</p>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25">Exercise 2 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></h4>
<div class="outline-text-4" id="text-orgheadline25">
<div class="org-src-container">

<pre class="src src-R">ceprCodebook <span class="org-constant">&lt;-</span> data.frame(
  ceprDataInfo[
    sapply(ceprDataInfo, length) == ncol(ceprData1)
  ])

ceprCodebook$mode <span class="org-constant">&lt;-</span> sapply(ceprData1, mode)
ceprCodebook$class <span class="org-constant">&lt;-</span> sapply(ceprData1, class)
ceprCodebook$n_distinct = sapply(ceprData1, <span class="org-keyword">function</span>(x) length(unique(x)))

rbind(head(ceprCodebook), tail(ceprCodebook))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-2">
<h2 id="orgheadline26">Aggregation</h2>
<div class="outline-text-2" id="text-orgheadline26">
<p>
Now that we have the data read in, and we know what is in each column, I want to calculate the proportion displaced by year/rural/gender. I can do that using the <code>aggregate</code> function (the <code>data.table</code> and <code>dplyr</code> packages provide advanced aggregation capabilities, but <code>aggregate</code> is available in base R and works well for many things).
</p>

<div class="org-src-container">

<pre class="src src-R">ceprData1 <span class="org-constant">&lt;-</span> aggregate(ceprData1[<span class="org-string">"dw"</span>],
                       by = ceprData1[c(<span class="org-string">"year"</span>, <span class="org-string">"rural"</span>, <span class="org-string">"female"</span>)],
                       FUN = mean, na.rm = <span class="org-type">TRUE</span>)
ceprData1
</pre>
</div>

<pre class="example">
&gt; ceprData1 &lt;- aggregate(ceprData1["dw"],
+                        by = ceprData1[c("year", "rural", "female")],
+                        FUN = mean, na.rm = TRUE)
&gt; ceprData1
  year rural female         dw
1 1994     0      0 0.09201620
2 1994     1      0 0.07094765
3 1994     0      1 0.06059583
4 1994     1      1 0.04579923
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-2">
<h2 id="orgheadline27">Exercise 3</h2>
<div class="outline-text-2" id="text-orgheadline27">
<p>
Now that we have a process for importing and aggregating the data we can apply it to all the data files we downloaded earlier. We can do that by wrapping the <code>read.dta</code> and <code>aggregate</code> code in a function and applying that function to each element of <code>dataFiles</code> using the <code>sapply</code> function, or using a <code>for</code> loop. Go ahead and give it a try! Note that this exercise is intentionally challenging; read the documentation, search stackoverflow.com, and use any other resources at your disposal as you attempt it.
</p>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-2">
<h2 id="orgheadline28">Exercise 3 prototype&#xa0;&#xa0;&#xa0;<span class="tag"><span class="prototype">prototype</span></span></h2>
<div class="outline-text-2" id="text-orgheadline28">
<div class="org-src-container">

<pre class="src src-R"><span class="org-constant">library</span>(foreign)

ceprData <span class="org-constant">&lt;-</span> mclapply(dataFiles, <span class="org-keyword">function</span>(x) {
  tmp <span class="org-constant">&lt;-</span> read.dta(x)
  <span class="org-keyword">return</span>(aggregate(tmp[<span class="org-string">"dw"</span>],
                   by = tmp[c(<span class="org-string">"year"</span>, <span class="org-string">"rural"</span>, <span class="org-string">"female"</span>)],
                   FUN = mean, na.rm = <span class="org-type">TRUE</span>))})
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-2">
<h2 id="orgheadline29">Finishing touches</h2>
<div class="outline-text-2" id="text-orgheadline29">
<p>
We now have a list of aggregated data.frames. The next step is to stack each element of the list so that we end up with one big data.frame instead of a list of small ones. We can stack two data.frames using the <code>rbind</code> function:
</p>
<div class="org-src-container">

<pre class="src src-R">ceprData[[<span class="org-highlight-numbers-number">1</span>]]; ceprData[[<span class="org-highlight-numbers-number">2</span>]]
rbind(ceprData[[<span class="org-highlight-numbers-number">1</span>]], ceprData[[<span class="org-highlight-numbers-number">2</span>]])
</pre>
</div>

<pre class="example">
&gt; ceprData[[1]]; ceprData[[2]]
  year rural female         dw
1 1994     0      0 0.09201620
2 1994     1      0 0.07094765
3 1994     0      1 0.06059583
4 1994     1      1 0.04579923
  year rural female         dw
1 1996     0      0 0.10207612
2 1996     1      0 0.09333333
3 1996     0      1 0.07761280
4 1996     1      1 0.06870622
&gt; rbind(ceprData[[1]], ceprData[[2]])
  year rural female         dw
1 1994     0      0 0.09201620
2 1994     1      0 0.07094765
3 1994     0      1 0.06059583
4 1994     1      1 0.04579923
5 1996     0      0 0.10207612
6 1996     1      0 0.09333333
7 1996     0      1 0.07761280
8 1996     1      1 0.06870622
&gt;
</pre>
<p>
and we can apply this operation to every element in the list using the <code>do.call</code> function.
</p>
<div class="org-src-container">

<pre class="src src-R">str(ceprData <span class="org-constant">&lt;-</span> do.call(<span class="org-string">"rbind"</span>, ceprData))
</pre>
</div>

<pre class="example">
&gt; str(ceprData &lt;- do.call("rbind", ceprData))
'data.frame':	36 obs. of  4 variables:
 $ year  : int  1994 1994 1994 1994 1996 1996 1996 1996 1998 1998 ...
 $ rural : int  0 1 0 1 0 1 0 1 0 1 ...
 $ female: int  0 0 1 1 0 0 1 1 0 0 ...
 $ dw    : num  0.092 0.0709 0.0606 0.0458 0.1021 ...
&gt;
</pre>
</div>

<div id="outline-container-orgheadline30" class="outline-3">
<h3 id="orgheadline30">Data formatting</h3>
<div class="outline-text-3" id="text-orgheadline30">
<p>
Our final step before plotting our data is to format the values for <code>rural</code> and <code>female</code>. Currently these values are stored as 0/1 dummy codes, but I would like for the values to be spelled out. 
</p>

<p>
Earlier we saw how to extract elements of R objects using bracket notation. To replace elements we using the replacement form, which looks like this:
</p>
<div class="org-src-container">

<pre class="src src-R"> ceprData[[<span class="org-string">"rural"</span>]] <span class="org-constant">&lt;-</span> factor(ceprData[[<span class="org-string">"rural"</span>]],
                               levels = c(<span class="org-highlight-numbers-number">0</span>, <span class="org-highlight-numbers-number">1</span>),
                               labels = c(<span class="org-string">"Non-rural"</span>, <span class="org-string">"Rural"</span>))

 ceprData[[<span class="org-string">"gender"</span>]] <span class="org-constant">&lt;-</span> factor(ceprData[[<span class="org-string">"female"</span>]],
                               levels = c(<span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">0</span>),
                               labels = c(<span class="org-string">"Female"</span>, <span class="org-string">"Male"</span>))

ceprData$displaced_percent <span class="org-constant">&lt;-</span> ceprData$dw * <span class="org-highlight-numbers-number">100</span>

str(ceprData)
</pre>
</div>

<pre class="example">
&gt;  ceprData[["rural"]] &lt;- factor(ceprData[["rural"]],
+                                levels = c(0, 1),
+                                labels = c("Non-rural", "Rural"))
&gt; 
&gt;  ceprData[["gender"]] &lt;- factor(ceprData[["female"]],
+                                levels = c(1, 0),
+                                labels = c("Female", "Male"))
&gt; 
&gt; ceprData$displaced_percent &lt;- ceprData$dw * 100
&gt; 
&gt; str(ceprData)
'data.frame':	36 obs. of  6 variables:
 $ year             : int  1994 1994 1994 1994 1996 1996 1996 1996 1998 1998 ...
 $ rural            : Factor w/ 2 levels "Non-rural","Rural": 1 2 1 2 1 2 1 2 1 2 ...
 $ female           : int  0 0 1 1 0 0 1 1 0 0 ...
 $ dw               : num  0.092 0.0709 0.0606 0.0458 0.1021 ...
 $ gender           : Factor w/ 2 levels "Female","Male": 2 2 1 1 2 2 1 1 2 2 ...
 $ displaced_percent: num  9.2 7.09 6.06 4.58 10.21 ...
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-3">
<h3 id="orgheadline31">Plotting</h3>
<div class="outline-text-3" id="text-orgheadline31">
<p>
Now we can take a look at the trends in worker displacement over the last few years.
</p>
<div class="org-src-container">

<pre class="src src-R"><span class="org-constant">library</span>(ggplot2)
<span class="org-constant">library</span>(directlabels)
ceprPlot <span class="org-constant">&lt;-</span> ggplot(ceprData, aes(x = year, y = displaced_percent, color = gender)) +
  geom_line() +
  geom_point() +
  facet_wrap(~rural)
direct.label(ceprPlot)
</pre>
</div>


<div class="figure">
<p><img src="images/out.png" alt="out.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-2">
<h2 id="orgheadline32">What else?</h2>
<div class="outline-text-2" id="text-orgheadline32">
<p>
If there is anything else you want to learn how to do, now is the time to ask!
</p>
</div>
</div>


<div id="outline-container-orgheadline33" class="outline-2">
<h2 id="orgheadline33">Go forth and code!</h2>
<div class="outline-text-2" id="text-orgheadline33">
<p>
You now know everything you could possibly want to know about R. OK maybe not! But you do know how to manipulate character strings with regular expressions, write your own functions, execute code conditionally, iterate using <code>for</code> or <code>sapply</code>, inspect and modify attributes, and extract and replace object elements. There's a lot more to learn, but that's a pretty good start. As you go forth and write your own R code here are some resources that may be helpful.
</p>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34">Additional reading and resources</h3>
<div class="outline-text-3" id="text-orgheadline34">
<ul class="org-ul">
<li>Learn from the best: <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a></li>
<li>S3 system overview: <a href="https://github.com/hadley/devtools/wiki/S3">https://github.com/hadley/devtools/wiki/S3</a></li>
<li>S4 system overview: <a href="https://github.com/hadley/devtools/wiki/S4">https://github.com/hadley/devtools/wiki/S4</a></li>
<li>R documentation: <a href="http://cran.r-project.org/manuals.html">http://cran.r-project.org/manuals.html</a></li>
<li>Collection of R tutorials: <a href="http://cran.r-project.org/other-docs.html">http://cran.r-project.org/other-docs.html</a></li>

<li>R for Programmers (by Norman Matloff, UC&#x2013;Davis)</li>
</ul>
<p>
<a href="http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf">http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf</a>
</p>
<ul class="org-ul">
<li>Calling C and Fortran from R (by Charles Geyer, UMinn)</li>
</ul>
<p>
<a href="http://www.stat.umn.edu/~charlie/rc/">http://www.stat.umn.edu/~charlie/rc/</a>
</p>
<ul class="org-ul">
<li>State of the Art in Parallel Computing with R (Schmidberger et al.)</li>
</ul>
<p>
<a href="http://www.jstatso%7C.org/v31/i01/paper">http://www.jstatso%7C.org/v31/i01/paper</a>
</p>

<ul class="org-ul">
<li>Institute for Quantitative Social Science: <a href="http://iq.harvard.edu/">http://iq.harvard.edu/</a></li>
<li>Research technology consulting: <a href="http://projects.iq.harvard.edu/rtc">http://projects.iq.harvard.edu/rtc</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-3">
<h3 id="orgheadline35">Things that may surprise you</h3>
<div class="outline-text-3" id="text-orgheadline35">
<p>
There are an unfortunately large number of surprises in R programming. Some of these "gotcha's" are common problems in other languages, many are unique to R. We will only cover a few &#x2013; for a more comprehensive discussion please see <a href="http://www.burns-stat.com/pages/Tutor/R_inferno.pdf">http://www.burns-stat.com/pages/Tutor/R_inferno.pdf</a>
</p>
</div>


<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36">Floating point comparison</h4>
<div class="outline-text-4" id="text-orgheadline36">
<p>
Floating point arithmetic is not exact:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock1">.1 == .3/<span class="org-highlight-numbers-number">3</span>
</pre>
</div>

<pre class="example">
&gt; .1 == .3/3
[1] FALSE
&gt;
</pre>

<p>
Solution: <code>use all.equal()</code>:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock2">all.equal(.1, .3/<span class="org-highlight-numbers-number">3</span>)
</pre>
</div>

<pre class="example">
&gt; all.equal(.1, .3/3)
[1] TRUE
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37">Missing values</h4>
<div class="outline-text-4" id="text-orgheadline37">
<p>
R does not exclude missing values by default &#x2013; a single missing value in a vector means that many thing are unknown:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock3">x <span class="org-constant">&lt;-</span> c(<span class="org-highlight-numbers-number">1:10</span>, <span class="org-type">NA</span>, <span class="org-highlight-numbers-number">12:20</span>)
c(mean(x), sd(x), median(x), min(x), sd(x))
</pre>
</div>

<pre class="example">
&gt; x &lt;- c(1:10, NA, 12:20)
&gt; c(mean(x), sd(x), median(x), min(x), sd(x))
[1] NA NA NA NA NA
&gt;
</pre>

<p>
NA is not equal to anything, not even NA
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock4"><span class="org-type">NA</span> == <span class="org-type">NA</span>
</pre>
</div>

<pre class="example">
&gt; NA == NA
[1] NA
&gt;
</pre>

<p>
Solutions: use <code>na.rm = TRUE</code> option when calculating, and is.na to test for missing
</p>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38">Automatic type conversion</h4>
<div class="outline-text-4" id="text-orgheadline38">
<p>
Automatic type conversion happens a lot which is often useful, but makes it easy to miss mistakes
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock5"><span class="org-comment-delimiter"># </span><span class="org-comment">combining values coereces them to the most general type</span>
(x <span class="org-constant">&lt;-</span> c(<span class="org-type">TRUE</span>, <span class="org-type">FALSE</span>, <span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">2</span>, <span class="org-string">"a"</span>, <span class="org-string">"b"</span>))
str(x)

<span class="org-comment-delimiter"># </span><span class="org-comment">comparisons convert arguments to most general type</span>
<span class="org-highlight-numbers-number">1</span> &gt; <span class="org-string">"a"</span>
</pre>
</div>

<pre class="example">
&gt; # combining values coereces them to the most general type
&gt; (x &lt;- c(TRUE, FALSE, 1, 2, "a", "b"))
[1] "TRUE"  "FALSE" "1"     "2"     "a"     "b"    
&gt; str(x)
 chr [1:6] "TRUE" "FALSE" "1" "2" "a" "b"
&gt; 
&gt; # comparisons convert arguments to most general type
&gt; 1 &gt; "a"
[1] FALSE
&gt;
</pre>

<p>
Maybe this is what you expect&#x2026; I would like to at least get a warning!
</p>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39">Optional argument inconsistencies</h4>
<div class="outline-text-4" id="text-orgheadline39">
<p>
Functions you might expect to work similarly don't always:
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock6">mean(<span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">2</span>, <span class="org-highlight-numbers-number">3</span>, <span class="org-highlight-numbers-number">4</span>, <span class="org-highlight-numbers-number">5</span>)*<span class="org-highlight-numbers-number">5</span>
sum(<span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">2</span>, <span class="org-highlight-numbers-number">3</span>, <span class="org-highlight-numbers-number">4</span>, <span class="org-highlight-numbers-number">5</span>)
</pre>
</div>

<pre class="example">
&gt; mean(1, 2, 3, 4, 5)*5
[1] 5
&gt; sum(1, 2, 3, 4, 5)
[1] 15
&gt;
</pre>

<p>
Why are these different?!?
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock7">args(mean)
args(sum)
</pre>
</div>

<pre class="example">
&gt; args(mean)
function (x, ...) 
NULL
&gt; args(sum)
function (..., na.rm = FALSE) 
NULL
&gt;
</pre>

<p>
Ouch. That is not nice at all!
</p>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40">Trouble with Factors</h4>
<div class="outline-text-4" id="text-orgheadline40">
<p>
Factors sometimes behave as numbers, and sometimes as characters, which can be confusing!
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock8">(x <span class="org-constant">&lt;-</span> factor(c(<span class="org-highlight-numbers-number">5</span>, <span class="org-highlight-numbers-number">5</span>, <span class="org-highlight-numbers-number">6</span>, <span class="org-highlight-numbers-number">6</span>), levels = c(<span class="org-highlight-numbers-number">6</span>, <span class="org-highlight-numbers-number">5</span>)))

str(x)

as.character(x)
<span class="org-comment-delimiter"># </span><span class="org-comment">here is where people sometimes get lost...</span>
as.numeric(x)
<span class="org-comment-delimiter"># </span><span class="org-comment">you probably want</span>
as.numeric(as.character(x))
</pre>
</div>

<pre class="example">
&gt; (x &lt;- factor(c(5, 5, 6, 6), levels = c(6, 5)))
[1] 5 5 6 6
Levels: 6 5
&gt; 
&gt; str(x)
 Factor w/ 2 levels "6","5": 2 2 1 1
&gt; 
&gt; as.character(x)
[1] "5" "5" "6" "6"
&gt; # here is where people sometimes get lost...
&gt; as.numeric(x)
[1] 2 2 1 1
&gt; # you probably want
&gt; as.numeric(as.character(x))
[1] 5 5 6 6
&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline41" class="outline-3">
<h3 id="orgheadline41">Feedback</h3>
<div class="outline-text-3" id="text-orgheadline41">
<ul class="org-ul">
<li>Help Us Make This Workshop Better!</li>
<li>Please take a moment to fill out a very short feedback form</li>
<li>These workshops exist for you &#x2013; tell us what you need!</li>
<li><a href="http://tinyurl.com/RprogrammingFeedback">http://tinyurl.com/RprogrammingFeedback</a></li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
Center for Economic and Policy Research. 2012. CPS Displaced Worker Uniform Extracts, Version 1.02. Washington, DC.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
Photo by Hadley Wickham via <a href="https://twitter.com/hadleywickham/status/643381054758363136/photo/1">https://twitter.com/hadleywickham/status/643381054758363136/photo/1</a>. Used by permission.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p><a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by-sa/4.0/80x15.png' /></a><span xmlns:dct='http://purl.org/dc/terms/' property='dct:title'> These statistical software workshop materials</span> by <a xmlns:cc='http://creativecommons.org/ns#' href='http://dss.iq.harvard.edu' property='cc:attributionName' rel='cc:attributionURL'>Harvard University</a> are licensed under a <a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p> <p> Presented by <a href='http://dss.iq.harvard.edu'>Data Science Services</a> at <br></br> <a href='http://iq.harvard.edu'><img style='margin-left: auto; margin-right: auto;' alt='The Institute for Quantitative Social Science' title='IQSS logo' src='http://static.projects.iq.harvard.edu/files/styles/os_files_small/public/rtc/files/iqsslogo-2014_0.png'></img></a></p>
</div>
</body>
</html>
