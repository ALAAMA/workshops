<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-10-02 Fri 16:16 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Introduction To Programming In R</title>
<meta  name="generator" content="Org-mode" />
<link rel="stylesheet" type="text/css" href="http://tutorials.iq.harvard.edu/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://tutorials.iq.harvard.edu/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Introduction To Programming In R</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline4">Workshop overview and materials</a>
<ul>
<li><a href="#orgheadline1">Workshop description</a></li>
<li><a href="#orgheadline2">Materials and setup</a></li>
<li><a href="#orgheadline3">Example project overview</a></li>
</ul>
</li>
<li><a href="#orgheadline5">Regular expressions, html parsing</a>
<ul>
<li><a href="#orgheadline6">Searching text with regular expressions</a></li>
<li><a href="#orgheadline7">Packages for parsing html</a></li>
<li><a href="#orgheadline8">Getting the list of data links the easy way</a></li>
</ul>
</li>
<li><a href="#orgheadline9">Iterating and defining new functions</a>
<ul>
<li><a href="#orgheadline10">Iterating using for-loop</a></li>
<li><a href="#orgheadline11">Writing functions</a></li>
<li><a href="#orgheadline12">The apply family of functions</a>
<ul>
<li><a href="#orgheadline13">Iterating over vectors and lists with the <code>sapply</code> function</a></li>
</ul>
</li>
<li><a href="#orgheadline16">Exersise 1</a></li>
</ul>
</li>
<li><a href="#orgheadline17">Objects, attributes, and indexing</a>
<ul>
<li><a href="#orgheadline18">Mode and length</a></li>
<li><a href="#orgheadline19">Indexing</a>
<ul>
<li><a href="#orgheadline20">Indexing lists</a></li>
<li><a href="#orgheadline21">Indexing vectors</a></li>
<li><a href="#orgheadline22">Indexing matrices</a></li>
<li><a href="#orgheadline23">Indexing data.frames</a></li>
<li><a href="#orgheadline24">Exercise 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline25">Aggregating and combining data</a></li>
<li><a href="#orgheadline31">The S3 object class system</a>
<ul>
<li><a href="#orgheadline26">The S3 object class system</a></li>
<li><a href="#orgheadline27">Object class</a></li>
<li><a href="#orgheadline28">Function methods</a></li>
<li><a href="#orgheadline29">Creating new function methods</a></li>
<li><a href="#orgheadline30">Creating generic functions</a></li>
</ul>
</li>
<li><a href="#orgheadline38">Things that may surprise you</a>
<ul>
<li><a href="#orgheadline32">Gotcha's</a></li>
<li><a href="#orgheadline33">Floating point comparison</a></li>
<li><a href="#orgheadline34">Missing values</a></li>
<li><a href="#orgheadline35">Automatic type conversion</a></li>
<li><a href="#orgheadline36">Optional argument inconsistencies</a></li>
<li><a href="#orgheadline37">Trouble with Factors</a></li>
</ul>
</li>
<li><a href="#orgheadline39">What else?</a></li>
<li><a href="#orgheadline42">Additional resources</a>
<ul>
<li><a href="#orgheadline40">Additional reading and resources</a></li>
<li><a href="#orgheadline41">Feedback</a></li>
</ul>
</li>
<li><a href="#orgheadline49">OLD STUFF</a>
<ul>
<li><a href="#orgheadline43">Vector types</a></li>
<li><a href="#orgheadline44">Vector attributes</a></li>
<li><a href="#orgheadline45">Factor vectors</a></li>
<li><a href="#orgheadline46">Lists and data.frames</a></li>
<li><a href="#orgheadline47">Data types summary</a></li>
<li><a href="#orgheadline48">Exercise 0</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">Workshop overview and materials</h2>
<div class="outline-text-2" id="text-orgheadline4">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1">Workshop description</h3>
<div class="outline-text-3" id="text-orgheadline1">
<p>
This is an intermediate/advanced R course appropriate for those with basic knowledge of R. It is intended for those already comfortable with using R for data analysis who wish to move on to writing their own functions. To the extent possible this workshop uses real-world examples. That is to say that concepts are introduced as they are needed for a realistic analysis task. 
</p>

<p>
Prerequisite: basic familiarity with R, such as acquired from an introductory R workshop.
</p>

<ul class="org-ul">
<li>Learning objectives:
<ul class="org-ul">
<li>Index data objects by position, name or logical condition</li>
<li>Understand looping and branching</li>
<li>Write your own simple functions</li>
<li>Debug functions</li>
<li>Understand and use the S3 object system</li>
</ul></li>
</ul>

<p>
This workshop is free for Harvard and MIT affiliates. <a href="http://projects.iq.harvard.edu/rtc/workshop-registration">Click here to sign up!</a>
</p>

<ul class="org-ul">
<li>Instructor - <a href="http://projects.iq.harvard.edu/rtc/people/ista-zahn">Ista Zahn</a></li>
<li>Location - Rm K018, 1737 Cambridge St (CGIS Knafel Building)</li>
</ul>

<p>
For further details and registration information, please contact us at <a href="mailto:dataclass@help.hmdc.harvard.edu">dataclass@help.hmdc.harvard.edu</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">Materials and setup</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
Everyone should have R installed &#x2013; if not:
</p>

<ul class="org-ul">
<li>Open a web browser and go to <a href="http://cran.r-project.org/">http://cran.r-project.org/</a> and download and install it</li>
<li>Also helpful to install RStudio (download from <a href="http://rstudio.com/">http://rstudio.com/</a>)</li>
</ul>

<p>
Materials for this workshop include slides, example data sets, and example code.
</p>

<ul class="org-ul">
<li>Download materials from <a href="http://tutorials.iq.harvard.edu/R/RProgramming.zip">http://tutorials.iq.harvard.edu/R/RProgramming.zip</a></li>
<li>Extract the zip file containing the materials to your desktop</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">Example project overview</h3>
<div class="outline-text-3" id="text-orgheadline3">
<p>
Throughout this workshop we will return to a running example that involves acquiring, processing, and analyzing data from the <a href="http://www.census.gov/cps/">Current Population Survey</a> (CPS). In this context we will learn about finding and using R packages, importing and manipulating data, writing functions, and more.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">Regular expressions, html parsing</h2>
<div class="outline-text-2" id="text-orgheadline5">
<p>
It is common for data to be made available on a website somewhere, either by a government agency, research group, or other organizations and entities. Often the data you want is spread over many files, and retrieving it all one file at a time is tedious and time consuming. Such is the case with the CPS data we will be using today.
</p>

<p>
The Center for Economic and Policy Research has helpfully <a href="http://ceprdata.org/cps-uniform-data-extracts/cps-outgoing-rotation-group/cps-org-data/">compiled CPS data going back to 1979</a><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>, one file per year. Although we could open a web browser and download these files one at a time, it will be faster and easier to instruct R to do that for us. Doing it this way will also give us an excuse to talk about regular expressions, package management, and other useful techniques.
</p>

<p>
Our goal is to download all the Stata data sets from <a href="http://ceprdata.org/cps-uniform-data-extracts/cps-outgoing-rotation-group/cps-org-data/">http://ceprdata.org/cps-uniform-data-extracts/cps-outgoing-rotation-group/cps-org-data/</a>. In order to do that we need a list of the Uniform Resource Locators (URLs) of those files. The URLs we need are right there as links in the ceprdata.org webpage. All we have to do is read that data in a way R can understand. 
</p>
</div>


<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Searching text with regular expressions</h3>
<div class="outline-text-3" id="text-orgheadline6">
<p>
Although some will say you should never ever attempt to extract information from html using regular expressions<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>, it does work OK for simple tasks. More generally regular expressions are useful in general (not just in R!) and it is a good idea to be familiar with at least the basics. If you have not been introduced to regular expressions yet a nice interactive regex tester is available at <a href="http://www.regexr.com/">http://www.regexr.com/</a> and an interactive tutorial is available at <a href="http://www.regexone.com/">http://www.regexone.com/</a>.
</p>

<p>
The fist step is to read the html into R. We can do that using the <code>readLines</code> function, like this:
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">Read html page from ceprdata.org into R. Each line will be stored as </span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">an element in a vector of lines.</span>
ceprHtmlIndex <span style="color: #a45bad;">&lt;-</span> readLines<span style="color: #2f96dc;">(</span>
<span style="color: #2d9574;">"http://ceprdata.org/cps-uniform-data-extracts/cps-outgoing-rotation-group/cps-org-data/"</span>
<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
OK, what are we working with?
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">how many lines do we have?</span>
length<span style="color: #2f96dc;">(</span>ceprHtmlIndex<span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">what do the first few lines look like?</span>
head<span style="color: #2f96dc;">(</span>ceprHtmlIndex, 10<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;">## </span><span style="color: #2aa198;">look at the first few lines of html</span>
</pre>
</div>

<p>
In html links are specified using the <code>&lt;a&gt;</code> (for <i>anchor</i>) tag. So now we want to search through our html and find lines that include an <code>a</code> tag. In R we can search for strings using the <code>grep</code> function.
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">find lines with links (a tags)</span>
<span style="color: #2f96dc;">(</span>aLineNumbers <span style="color: #a45bad;">&lt;-</span> grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&lt;a"</span>, ceprHtmlIndex<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">line numbers containing &lt;a&gt; tags</span>
head<span style="color: #2f96dc;">(</span>aLines <span style="color: #a45bad;">&lt;-</span> grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&lt;a"</span>, ceprHtmlIndex, value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">lines containing &lt;a&gt; tags</span>
</pre>
</div>

<p>
So far we've successfully matched all lines containing the string "&lt;a". Our actual target is a bit more specific. If we inspect the elements we want to match using our web browser we'll see something like this:<img src="images/inspectHtml.png" alt="inspectHtml.png" /> 
</p>

<div class="org-src-container">

<pre class="src src-HTML">&lt;a onclick="_gaq.push(['_trackEvent', 'File','Download', 'cepr_org_2011']);" href="/wp-content/cps/data/cepr_org_2014.zip"&gt;cepr_org_2014.zip&lt;/a&gt;
</pre>
</div>
<p>
This tells us that we want to match lines containing an "&lt;a" followed (eventually) by ".zip". In order to perform this more sophisticated search we need to use <i>regular expressions</i>. In regular expressions the <code>.</code> matches any character (except new lines) and the <code>*</code> repeats the previous character zero or more times. So <code>&lt;a.*\\.zip</code> means "find <code>&lt;a</code> followed by any character repeated any number of times followed by <code>.zip</code>". Note that in <code>\\.</code> the backslashes escape the dot so that it is matched literally rather than matching any character. Let's try it out!
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">find lines with &lt;a&gt; tags refering to zip files</span>
head<span style="color: #2f96dc;">(</span>dataLines <span style="color: #a45bad;">&lt;-</span> grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&lt;a.*\\.zip"</span>, ceprHtmlIndex, value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
We're getting close! We have identified the lines containing the information we need. Now we just need to extract the text following the <code>href</code> argument. For that we need to use another feature of regular expressions called <i>capture groups</i> and <i>back references</i>. Here's how it works:
</p>
<div class="org-src-container">

<pre class="src src-R">head<span style="color: #2f96dc;">(</span>dataURLs <span style="color: #a45bad;">&lt;-</span> gsub<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"^.*href=\"(.*\\.zip)\".*$"</span>, <span style="color: #2d9574;">"\\1"</span>, dataLines<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Great, we've matched all the data file links. The next step is to iterate over these links and download the data. But before we get there, let's look at a couple of alternative methods we could use to get the list of data file links.
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">Packages for parsing html</h3>
<div class="outline-text-3" id="text-orgheadline7">
<p>
In the previous section we extracted data file links from an html page using regular expressions. An alternative is to use a package dedicated to parsing XML and HTML. How do we find such a package?
</p>
<dl class="org-dl">
<dt>Task views</dt><dd><a href="https://cran.r-project.org/web/views/WebTechnologies.html">https://cran.r-project.org/web/views/WebTechnologies.html</a></dd>
<dt>R package search</dt><dd><a href="http://www.r-pkg.org/search.html?q=html+xml">http://www.r-pkg.org/search.html?q=html+xml</a></dd>
<dt>Web search</dt><dd><a href="https://www.google.com/search?q=R+parse+html+xml&amp;ie=utf-8&amp;oe=utf-8">https://www.google.com/search?q=R+parse+html+xml&ie=utf-8&oe=utf-8</a></dd>
</dl>

<p>
For parsing html in R I recommend either the <code>httr</code> package or the <code>rvest</code> package, with the former being more flexible and the later being more user friendly. Let's use the friendlier one.
</p>

<div class="org-src-container">

<pre class="src src-R">  <span style="color: #2aa198;">## </span><span style="color: #2aa198;">install.packages("rvest")</span>
  <span style="color: #a45bad;">library</span><span style="color: #2f96dc;">(</span>rvest<span style="color: #2f96dc;">)</span>
  dataPage <span style="color: #a45bad;">&lt;-</span> html<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"http://ceprdata.org/cps-uniform-data-extracts/cps-outgoing-rotation-group/cps-org-data/"</span><span style="color: #2f96dc;">)</span>

  <span style="color: #2aa198;">## </span><span style="color: #2aa198;">find the link ("a") elemets extract the link ("href") attributes</span>
  allLinks <span style="color: #a45bad;">&lt;-</span> html_attr<span style="color: #2f96dc;">(</span>html_nodes<span style="color: #bc6ec5;">(</span>dataPage, <span style="color: #2d9574;">"a"</span><span style="color: #bc6ec5;">)</span>, <span style="color: #2d9574;">"href"</span><span style="color: #2f96dc;">)</span>
  dataLinks <span style="color: #a45bad;">&lt;-</span> paste<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"http://ceprdata.org"</span>,
                     grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"^/wp-content/cps/data/.*\\.zip$"</span>,
                          allLinks,
                          value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span>,
                     sep = <span style="color: #2d9574;">""</span><span style="color: #2f96dc;">)</span>
head<span style="color: #2f96dc;">(</span>dataLinks<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Wow, that that was a lot easier. Why didn't we do that in the first place?!? Well, if we had done it the easy way I wouldn't have had an excuse to teach you about regular expressions! And trust me, you need to know about regular expressions. 
</p>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">Getting the list of data links the easy way</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
If you look at the result from the previous two methods you might notice that the URLs are all the same save for the year number. This suggests an even easier way to construct the list of URLs:
</p>
<div class="org-src-container">

<pre class="src src-R">head<span style="color: #2f96dc;">(</span>dataLinks <span style="color: #a45bad;">&lt;-</span> paste<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"http://ceprdata.org/wp-content/cps/data/cepr_org_"</span>,
                    1979:2014,
                    <span style="color: #2d9574;">".zip"</span>,
                    sep = <span style="color: #2d9574;">""</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Wow, that was a <span class="underline">lot</span> easier. Why oh why didn't we just do that in the first place? Well, it works for this specific case, but it is much less general than the regular expression method or the html parsing method we discussed previously. Those methods will work in the general case, while pasting the year number into the URLs only works because the URLs we want have a very regular and consistent form.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9">Iterating and defining new functions</h2>
<div class="outline-text-2" id="text-orgheadline9">
<p>
Now that we have a vector of URLs pointing to the data files we want to download, we want to iterate over the elements and download each file. We could do this verbosely by writing one line for each file:
</p>
<div class="org-src-container">

<pre class="src src-R">dir.create<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"dataSets"</span><span style="color: #2f96dc;">)</span>
download.file<span style="color: #2f96dc;">(</span>dataLinks<span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span>, <span style="color: #2d9574;">"dataSets/cepr_org_1979.zip"</span><span style="color: #2f96dc;">)</span>
download.file<span style="color: #2f96dc;">(</span>dataLinks<span style="color: #bc6ec5;">[</span>2<span style="color: #bc6ec5;">]</span>, <span style="color: #2d9574;">"dataSets/cepr_org_1980.zip"</span><span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">...</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">download.file(dataLinks[n], "dataSets/cepr_org_n.zip")</span>
</pre>
</div>
<p>
but that is too much typing. Much easier to let R do that for us. We can iterate over the elements of a vector in R using a loop, or using one of the <code>apply</code> family of functions.
</p>

<p>
<code>for</code> and <code>while</code> loops in R work much the same as they do in other programming languages. The <code>apply</code> family of functions apply a function to each element of an object.
</p>
</div>

<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">Iterating using for-loop</h3>
<div class="outline-text-3" id="text-orgheadline10">
<p>
One way to download the data files is to use a for-loop to iterate over the contents of our vector of URLs. Some people will tell you to avoid for-loops in R but this is nonsense. Loops are convenient and useful, and while they are not the best tool for all situations calling for iteration they are perfectly appropriate for downloading a series of files. If you've used a for loop in any other language you will probably find the R implementation to be very similar. 
</p>

<p>
For now, lets start by downloading just the data files for years since 2010.
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #237fbf; font-weight: bold;">for</span><span style="color: #2f96dc;">(</span>link <span style="color: #237fbf; font-weight: bold;">in</span> grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"org_201"</span>, dataLinks, value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span>
    download.file<span style="color: #bc6ec5;">(</span>link, 
                  destfile = basename<span style="color: #2d9574;">(</span>link<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
<span style="color: #2f96dc;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11">Writing functions</h3>
<div class="outline-text-3" id="text-orgheadline11">
<p>
Our for loop works well for downloading the data files form ceprdata.org. But what if we need to download data from other URLs as well? It might be nice to have a re-usable function that takes a url and downloads it, saving the result as the <code>basename</code> of the url. We can define such a function using the <code>function</code> function (say that three times fast!).
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #bc6ec5; font-weight: bold;">downloadFiles</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #2f96dc;">(</span>urls<span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span>
  <span style="color: #237fbf; font-weight: bold;">for</span><span style="color: #bc6ec5;">(</span>link <span style="color: #237fbf; font-weight: bold;">in</span> urls<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
      download.file<span style="color: #2d9574;">(</span>link, 
                    destfile = basename<span style="color: #67b11d;">(</span>link<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #2f96dc;">}</span>
</pre>
</div>

<p>
Now we can download files more simply with
</p>
<div class="org-src-container">

<pre class="src src-R">downloadFiles<span style="color: #2f96dc;">(</span>grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"org_201"</span>, dataLinks, value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>
<p>
and in fact we can use this function to download files from any urls we might have.
</p>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12">The apply family of functions</h3>
<div class="outline-text-3" id="text-orgheadline12">
<p>
The <i>apply family</i> of functions in R that are useful for iteration. The apply family of functions includes:
</p>
<dl class="org-dl">
<dt>apply</dt><dd>apply a function to each dimension (e.g., row or column), of a matrix or array</dd>
<dt>lapply</dt><dd>apply a function to each element of a vector or list</dd>
<dt>sapply</dt><dd>like lapply, but simplifies the result</dd>
<dt>mapply</dt><dd>apply a function to each element of multiple vectors or lists</dd>
</dl>

<p>
Confused yet? The bad news is, there are more of these; see <code>?lapply</code>, <code>?Map</code> and <a href="http://stackoverflow.com/questions/3505701/r-grouping-functions-sapply-vs-lapply-vs-apply-vs-tapply-vs-by-vs-aggrega">this StackOverflow answer</a> for details. The good news is you can do quite a lot with just <code>apply</code> and <code>sapply</code>. 
</p>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13">Iterating over vectors and lists with the <code>sapply</code> function</h4>
<div class="outline-text-4" id="text-orgheadline13">
<p>
The <code>sapply</code> function iterates over a vector or list and applys a function to each element. To start, let's use <code>sapply</code> do download all the data files for years since 2010:
</p>
<div class="org-src-container">

<pre class="src src-R">sapply<span style="color: #2f96dc;">(</span>grep<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"org_201"</span>, dataLinks, value = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #bc6ec5;">)</span>,
       <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span> download.file<span style="color: #bc6ec5;">(</span>x, destfile = basename<span style="color: #2d9574;">(</span>x<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
       <span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
For this task (downloading files) there is not much advantage to using <code>sapply</code> instead of <code>for</code>. The main advantage is the simpler handling of return values. To see this, let's revisit the profile picture example. Our goal is to read all the .png files in our working directory. We've already seen how to do this with <code>sapply</code>;
</p>
<div class="org-src-container">

<pre class="src src-R">imgs <span style="color: #a45bad;">&lt;-</span> sapply<span style="color: #2f96dc;">(</span>list.files<span style="color: #bc6ec5;">(</span>pattern = <span style="color: #2d9574;">"\\.png$"</span><span style="color: #bc6ec5;">)</span>,
               read.bitmap<span style="color: #2f96dc;">)</span>
</pre>
</div>
<p>
How can we do that with a for loop? First we need to create a list to store the restults, then as we loop through we need to assign the image data to an element of the list. It's not terrible:
</p>
<div class="org-src-container">

<pre class="src src-R">imgs <span style="color: #a45bad;">&lt;-</span> list<span style="color: #2f96dc;">()</span>
<span style="color: #237fbf; font-weight: bold;">for</span> <span style="color: #2f96dc;">(</span>file <span style="color: #237fbf; font-weight: bold;">in</span> list.files<span style="color: #bc6ec5;">(</span>pattern = <span style="color: #2d9574;">"\\.png$"</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span>
  imgs<span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">[</span>file<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">]</span> <span style="color: #a45bad;">&lt;-</span> read.bitmap<span style="color: #bc6ec5;">(</span>file<span style="color: #bc6ec5;">)</span>
<span style="color: #2f96dc;">}</span>
</pre>
</div>
<p>
As I said, not terrible, but definitely more complicated than the sapply version. 
</p>
</div>

<ul class="org-ul"><li><a id="orgheadline14"></a>Iterating over arrays with the <code>apply</code> function<br  /><div class="outline-text-5" id="text-orgheadline14">
<p>
Now that we've downloaded some of the ceprdata.org data we might want to get some information about these files. We can do that using the <code>file.info</code> function:
</p>
<div class="org-src-container">

<pre class="src src-R">ceprFiles <span style="color: #a45bad;">&lt;-</span> list.files<span style="color: #2f96dc;">(</span>pattern = <span style="color: #2d9574;">"\\.zip"</span><span style="color: #2f96dc;">)</span>
ceprFileInfo <span style="color: #a45bad;">&lt;-</span> cbind<span style="color: #2f96dc;">(</span>size = file.size<span style="color: #bc6ec5;">(</span>ceprFiles<span style="color: #bc6ec5;">)</span>, mode = file.mode<span style="color: #bc6ec5;">(</span>ceprFiles<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
rownames<span style="color: #2f96dc;">(</span>ceprFileInfo<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> ceprFiles
ceprFileInfo
</pre>
</div>
<p>
ceprFileInfo is a <span class="underline">matrix</span>, with each row containing information about one of the files we downloaded. We can calculate the means for each column in this mattrix using the <code>apply</code> fuction:
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">average file size and permissions</span>
<span style="color: #2f96dc;">(</span>fileInfoAverage <span style="color: #a45bad;">&lt;-</span> apply<span style="color: #bc6ec5;">(</span>ceprFileInfo, MARGIN = 2, mean<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">standard deviation of file size and permissions</span>
apply<span style="color: #2f96dc;">(</span>ceprFileInfo, MARGIN = 2, sd<span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">deviation from the average</span>
apply<span style="color: #2f96dc;">(</span>ceprFileInfo, MARGIN = 1, <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span> x - fileInfoAverage<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;">#</span>
</pre>
</div>
</div></li>


<li><a id="orgheadline15"></a>Back to the business at hand<br  /><div class="outline-text-5" id="text-orgheadline15">
<p>
OK OK, we got sidetracked with profile pics and apply functions. Eyes on the prize; we want to import and process the files we downloaded from ceprdata.org. First we need to unzip them and check the size of each file
</p>
<div class="org-src-container">

<pre class="src src-R">sapply<span style="color: #2f96dc;">(</span>ceprFiles, unzip<span style="color: #2f96dc;">)</span>
ceprDataFiles <span style="color: #a45bad;">&lt;-</span> list.files<span style="color: #2f96dc;">(</span>pattern = <span style="color: #2d9574;">"\\.dta$"</span><span style="color: #2f96dc;">)</span>
file.size<span style="color: #2f96dc;">(</span>ceprDataFiles<span style="color: #2f96dc;">)</span>/1024^2 <span style="color: #2aa198;">#</span><span style="color: #2aa198;">give size in Mb</span>
</pre>
</div>

<p>
Finally we can read our data into R, but I leave that to you!
</p>
</div></li></ul>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16">Exersise 1</h3>
<div class="outline-text-3" id="text-orgheadline16">
<p>
Read in the cepr data for years 2010 and greater. 
</p>

<p>
BONUS (optional): calculate the size of each of the data sets you read in.
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline17" class="outline-2">
<h2 id="orgheadline17">Objects, attributes, and indexing</h2>
<div class="outline-text-2" id="text-orgheadline17">
<p>
Now that we've read in the cepr.org data we want to get some more information about it. 
</p>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18">Mode and length</h3>
<div class="outline-text-3" id="text-orgheadline18">
<p>
Information about objects in R are stored as <i>attributes</i> of the object. All R objects have a storage <i>mode</i> and a <i>length</i>. Since all objects in R have the attributes we refer to them as <i>intrinsic attributes</i>. We can get the value of these intrinsic attributes using the <code>mode</code> and <code>length</code> functions respecively. For example, what is the mode and length of our <code>ceprData</code> object?
</p>
<div class="org-src-container">

<pre class="src src-R">mode<span style="color: #2f96dc;">(</span>ceprData<span style="color: #2f96dc;">)</span>
length<span style="color: #2f96dc;">(</span>ceprData<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Additional attributes and be accessed vie the <code>attributes</code> function. Let's see what other attributes our <code>ceprData</code> object has.
</p>
<div class="org-src-container">

<pre class="src src-R">attributes<span style="color: #2f96dc;">(</span>ceprData<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
OK, so far we know that ceprData is a list of length 4 and that it has a names attribute. How can we find out what is inside the list?
</p>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19">Indexing</h3>
<div class="outline-text-3" id="text-orgheadline19">
<p>
We can extract or replace elements of R objects using bracket indexing. Exactly how indexing works differs slightly depending on what kind of object we are working with.
</p>
</div>

<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20">Indexing lists</h4>
<div class="outline-text-4" id="text-orgheadline20">
<p>
For lists we can index using a single bracket to extract one or more elements of the list, or we can index using double brackets to extract a single element.
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">## </span><span style="color: #2aa198;">what do we get when we extract one element with single brackets?</span>
length<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; mode<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; class<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; attributes<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">what do we get when we extract the middle two elements with single brackets?</span>
length<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>2:3<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; mode<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>2:3<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; class<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>2:3<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; attributes<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span>2:3<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;">## </span><span style="color: #2aa198;">what do we get when we extract the first element with a double bracket</span>
length<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">[</span>1<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; mode<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">[</span>1<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>; class<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">[</span>1<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span><span style="color: #2aa198;">#</span>
</pre>
</div>

<p>
Right. So what have we learned? We've learned that indexing lists works like this:
<img src="images/HadleyWickham_index_list.png" alt="HadleyWickham_index_list.png" /><sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup>
</p>

<p>
We've also learned that <code>ceprData[[1]]</code> has mode <code>list</code> but <i>class</i> <code>data.frame</code>. We can find out more about these data structures by reading their help pages (<code>?list</code> and <code>?data.frame</code>), but briefly a data.frame is a special kind of list that is constrained such that all elements have the same length. A data.frame is a rectangular structure that can be indexed by rows and columns (more on this in a moment).
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21">Indexing vectors</h4>
<div class="outline-text-4" id="text-orgheadline21">
<p>
You may have noticed in the previous code example that I did <span class="underline">not</span> ask for <code>attributes(ceprData[[1]])</code>. The reason for that is that each element of <code>ceprDATA</code> is a <code>data.frame</code> with a large number of attributes. Let's look at those attributes in a bit more detail.
</p>

<div class="org-src-container">

<pre class="src src-R">ceprDataInfo <span style="color: #a45bad;">&lt;-</span> attributes<span style="color: #2f96dc;">(</span>ceprData<span style="color: #bc6ec5;">[</span><span style="color: #2d9574;">[</span>1<span style="color: #2d9574;">]</span><span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>
mode<span style="color: #2f96dc;">(</span>ceprDataInfo<span style="color: #2f96dc;">)</span>
class<span style="color: #2f96dc;">(</span>ceprDataInfo<span style="color: #2f96dc;">)</span>
length<span style="color: #2f96dc;">(</span>ceprDataInfo<span style="color: #2f96dc;">)</span>
names<span style="color: #2f96dc;">(</span>ceprDataInfo<span style="color: #2f96dc;">)</span>
<span style="color: #2f96dc;">(</span>ceprInfoLength <span style="color: #a45bad;">&lt;-</span> sapply<span style="color: #bc6ec5;">(</span>ceprDataInfo, length<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
<code>ceprInfoLength</code> is an <i>atomic vector</i>, i.e., a vector with all elements of the same mode. We can index a vector with <code>[</code> and <code>[[</code>, just as we do for lists.
</p>

<div class="org-src-container">

<pre class="src src-R">mode<span style="color: #2f96dc;">(</span>ceprInfoLength<span style="color: #2f96dc;">)</span>; class<span style="color: #2f96dc;">(</span>ceprInfoLength<span style="color: #2f96dc;">)</span>; length<span style="color: #2f96dc;">(</span>ceprInfoLength<span style="color: #2f96dc;">)</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>1<span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span><span style="color: #bc6ec5;">[</span>1<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>1:10<span style="color: #2f96dc;">]</span>
</pre>
</div>


<p>
The code above is an example of <i>indexing by position</i>. We can also index by <i>name</i> or using <i>logical indexing</i> as shown below.
</p>
<div class="org-src-container">

<pre class="src src-R">ceprInfoLength<span style="color: #2f96dc;">[</span>c<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"names"</span>, <span style="color: #2d9574;">"formats"</span>, <span style="color: #2d9574;">"types"</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>grepl<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"lab"</span>, names<span style="color: #2d9574;">(</span>ceprInfoLength<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>ceprInfoLength == 1<span style="color: #2f96dc;">]</span>
names<span style="color: #2f96dc;">(</span>ceprInfoLength<span style="color: #2f96dc;">)[</span>ceprInfoLength == 1<span style="color: #2f96dc;">]</span>
</pre>
</div>

<p>
Finally, we can use negation and negative indices to reverse the usual meanings.
</p>
<div class="org-src-container">

<pre class="src src-R">ceprInfoLength<span style="color: #2f96dc;">[</span>- c<span style="color: #bc6ec5;">(</span>3, 7, 9<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>setdiff<span style="color: #bc6ec5;">(</span>names<span style="color: #2d9574;">(</span>ceprInfoLength<span style="color: #2d9574;">)</span>, c<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"names"</span>, <span style="color: #2d9574;">"formats"</span>, <span style="color: #2d9574;">"types"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
ceprInfoLength<span style="color: #2f96dc;">[</span>!grepl<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"lab"</span>, names<span style="color: #2d9574;">(</span>ceprInfoLength<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-4">
<h4 id="orgheadline22">Indexing matrices</h4>
<div class="outline-text-4" id="text-orgheadline22">
<p>
Now that we know a little more about indexing, let's get back to investigating the ceprData metadata. 
</p>

<div class="org-src-container">

<pre class="src src-R"><span style="color: #2f96dc;">(</span>infoInfo <span style="color: #a45bad;">&lt;-</span> sapply<span style="color: #bc6ec5;">(</span>ceprDataInfo, <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #2d9574;">(</span>x<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
  <span style="color: #237fbf; font-weight: bold;">return</span><span style="color: #67b11d;">(</span>c<span style="color: #b1951d;">(</span>mode = mode<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>, class = class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>, length = length<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
  <span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
<code>infoInfo</code> contains information about the contents of <code>ceprDataInfo</code>. <code>infoInfo</code> is a <i>matrix</i>. A matrix in R is simply a vector with two dimensions. We can index a matrix exactly as we do a vector:
</p>
<div class="org-src-container">

<pre class="src src-R">infoInfo
infoInfo<span style="color: #2f96dc;">[</span>c<span style="color: #bc6ec5;">(</span>1, 3, 9<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
</pre>
</div>

<p>
but more commonly we will index a matrix by referring to both dimensions, like this:
</p>
<div class="org-src-container">

<pre class="src src-R">infoInfo<span style="color: #2f96dc;">[</span>1:2, c<span style="color: #bc6ec5;">(</span>7, 3, 1<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
infoInfo<span style="color: #2f96dc;">[</span> , 1:2<span style="color: #2f96dc;">]</span>
infoInfo<span style="color: #2f96dc;">[</span>3:2, <span style="color: #2f96dc;">]</span>
</pre>
</div>

<p>
All the techniques we learned for indexing vectors apply. For example:
</p>
<div class="org-src-container">

<pre class="src src-R">attributes<span style="color: #2f96dc;">(</span>infoInfo<span style="color: #2f96dc;">)</span>
infoInfo<span style="color: #2f96dc;">[</span>c<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"length"</span>, <span style="color: #2d9574;">"mode"</span><span style="color: #bc6ec5;">)</span>, grepl<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"name"</span>, colnames<span style="color: #2d9574;">(</span>infoInfo<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23">Indexing data.frames</h4>
<div class="outline-text-4" id="text-orgheadline23">
<p>
As we noted earlier data.frames are a special kind of list. Therefore both <code>[</code> and <code>[[</code> indexing will work exactly as they do for lists. Unlike other lists, data.frames have two dimensions (like a matrix), so two-dimensional indexing works on data.frames just as it does for matrices.
</p>
</div>
</div>


<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24">Exercise 2</h4>
<div class="outline-text-4" id="text-orgheadline24">
<p>
Extract elements from <code>ceprDataInfo</code> that will help you understand what each column contains. Include at least the variable <code>names</code> and <code>var.labels</code> as well as any other information that you think will be useful.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-2">
<h2 id="orgheadline25">Aggregating and combining data</h2>
<div class="outline-text-2" id="text-orgheadline25">
<p>
Now that we have all the data read in, and we know what is in each column, I want to aggregate the data to down to a managable size. Specifically I want to calculate the average income by state/year/rural/gender. I can do that using the <code>aggregate</code> function (the <code>data.table</code> and <code>dplyr</code> packages provide advanced aggregation capabilities, but <code>aggregate</code> is available in base R and works well for many things).
</p>

<div class="org-src-container">

<pre class="src src-R">ceprData <span style="color: #a45bad;">&lt;-</span> sapply<span style="color: #2f96dc;">(</span>ceprData, <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
  aggregate<span style="color: #2d9574;">(</span>x<span style="color: #67b11d;">[</span><span style="color: #2d9574;">"rw"</span><span style="color: #67b11d;">]</span>,
            by = x<span style="color: #67b11d;">[</span>c<span style="color: #b1951d;">(</span><span style="color: #2d9574;">"year"</span>, <span style="color: #2d9574;">"state"</span>, <span style="color: #2d9574;">"rural"</span>, <span style="color: #2d9574;">"female"</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>,
            FUN = mean, na.rm = <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">}</span>,
  simplify = <span style="color: #ce537a; font-weight: bold;">FALSE</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
In particular combine all the data together into a single data.frame. Right now we have a list of data.frames, and we simply want to stack this one on top of the other. We can do that with the <code>rbind</code> function. (Other ways you might want to combine data are described in <code>?cbind</code> and <code>?merge</code>).
</p>

<p>
A straightforward way to combine the data looks like this
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #2aa198;">#</span><span style="color: #2aa198;">ceprData &lt;- rbind(ceprData[[1]], ceprData[[2]], ceprData[[3]], ceprData[[4]])</span>
</pre>
</div>

<p>
and that's not too bad for four elements. But what if we had 100 or 1000000? You certainly don't want to type that many elements out yourself. Instead you can use <code>Reduce</code> to flatten the list, like this:
</p>
<div class="org-src-container">

<pre class="src src-R">ceprData <span style="color: #a45bad;">&lt;-</span> Reduce<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"rbind"</span>, ceprData<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Now we can take a look at the trends in wages over the last few years.
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #a45bad;">library</span><span style="color: #2f96dc;">(</span>ggplot2<span style="color: #2f96dc;">)</span>
ggplot<span style="color: #2f96dc;">(</span>ceprData, aes<span style="color: #bc6ec5;">(</span>x = year, y = rw, color = factor<span style="color: #2d9574;">(</span>female<span style="color: #2d9574;">)</span>, linetype = factor<span style="color: #2d9574;">(</span>rural<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> +
  geom_line<span style="color: #2f96dc;">()</span> +
  facet_wrap<span style="color: #2f96dc;">(</span>~state, ncol = 9<span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-2">
<h2 id="orgheadline31">The S3 object class system</h2>
<div class="outline-text-2" id="text-orgheadline31">
</div><div id="outline-container-orgheadline26" class="outline-3">
<h3 id="orgheadline26">The S3 object class system</h3>
<div class="outline-text-3" id="text-orgheadline26">
<p>
R has two major object systems: 
</p>
<ul class="org-ul">
<li>Relatively informal "S3" classes</li>
<li>Stricter, more formal "S4" classes</li>
</ul>
<ul class="org-ul">
<li>We will cover only the S3 system, not the S4 system</li>
<li>Basic idea: functions have different methods for different types of objects</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27">Object class</h3>
<div class="outline-text-3" id="text-orgheadline27">
<p>
The class of an object can be retrieved and modified using the <code>class()</code> function:
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock1">x <span style="color: #a45bad;">&lt;-</span> 1:10
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> 
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #2d9574;">"foo"</span>
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Objects are not limited to a single class, and can have many classes:
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock2">class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"A"</span>, <span style="color: #2d9574;">"B"</span><span style="color: #2f96dc;">)</span>
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline28" class="outline-3">
<h3 id="orgheadline28">Function methods</h3>
<div class="outline-text-3" id="text-orgheadline28">
<ul class="org-ul">
<li>Functions can have many methods, allowing us to have (e.g.) one plot() function that does different things depending on what is being plotted()</li>
<li>Methods can only be defined for generic functions: plot, print, summary, mean, and several others are already generic</li>
</ul>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock3"><span style="color: #2aa198;"># </span><span style="color: #2aa198;">see what methods have been defined for the mean function</span>
methods<span style="color: #2f96dc;">(</span>mean<span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;"># </span><span style="color: #2aa198;">which functions have methods for data.frames?</span>
methods<span style="color: #2f96dc;">(</span>class=<span style="color: #2d9574;">"data.frame"</span><span style="color: #2f96dc;">)[</span>1:9<span style="color: #2f96dc;">]</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline29" class="outline-3">
<h3 id="orgheadline29">Creating new function methods</h3>
<div class="outline-text-3" id="text-orgheadline29">
<p>
To create a new method for a function that is already generic all you have to do is name your function <code>function.class</code>
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock4"><span style="color: #2aa198;"># </span><span style="color: #2aa198;">create a mean() method for objects of class "foo":</span>
<span style="color: #bc6ec5; font-weight: bold;">mean.foo</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">mean method for "foo" class</span>
  <span style="color: #237fbf; font-weight: bold;">if</span><span style="color: #bc6ec5;">(</span>is.numeric<span style="color: #2d9574;">(</span>x<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
    cat<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"The average is"</span>, mean.default<span style="color: #67b11d;">(</span>x<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #237fbf; font-weight: bold;">return</span><span style="color: #2d9574;">(</span>invisible<span style="color: #67b11d;">(</span>mean.default<span style="color: #b1951d;">(</span>x<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #2aa198;">#</span><span style="color: #2aa198;">use mean.default for numeric</span>
  <span style="color: #bc6ec5;">}</span> <span style="color: #237fbf; font-weight: bold;">else</span>
    cat<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"x is not numeric \n"</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">}</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">otherwise say x not numeric</span>

x <span style="color: #a45bad;">&lt;-</span> 1:10
mean<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #2d9574;">"foo"</span>
mean<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>

x <span style="color: #a45bad;">&lt;-</span> as.character<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
class<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #2d9574;">"foo"</span>
mean<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline30" class="outline-3">
<h3 id="orgheadline30">Creating generic functions</h3>
<div class="outline-text-3" id="text-orgheadline30">
<p>
S3 generics are most often used for print, summary, and plot methods, but sometimes you may want to create a new generic function
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock5"><span style="color: #2aa198;"># </span><span style="color: #2aa198;">create a generic disp() function</span>
<span style="color: #bc6ec5; font-weight: bold;">disp</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #2f96dc;">(</span>x, ...<span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span>
  UseMethod<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"disp"</span><span style="color: #bc6ec5;">)</span>
<span style="color: #2f96dc;">}</span>

<span style="color: #2aa198;"># </span><span style="color: #2aa198;">create a disp method for class "matrix"</span>
<span style="color: #bc6ec5; font-weight: bold;">disp.matrix</span> <span style="color: #a45bad;">&lt;-</span> <span style="color: #237fbf; font-weight: bold;">function</span><span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span> <span style="color: #2f96dc;">{</span>
  print<span style="color: #bc6ec5;">(</span>round<span style="color: #2d9574;">(</span>x, digits=2<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
<span style="color: #2f96dc;">}</span>

<span style="color: #2aa198;"># </span><span style="color: #2aa198;">test it out</span>
disp<span style="color: #2f96dc;">(</span>matrix<span style="color: #bc6ec5;">(</span>runif<span style="color: #2d9574;">(</span>10<span style="color: #2d9574;">)</span>, ncol=2<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline38" class="outline-2">
<h2 id="orgheadline38">Things that may surprise you</h2>
<div class="outline-text-2" id="text-orgheadline38">
</div><div id="outline-container-orgheadline32" class="outline-3">
<h3 id="orgheadline32">Gotcha's</h3>
<div class="outline-text-3" id="text-orgheadline32">
<ul class="org-ul">
<li>There are an unfortunately large number of surprises in R programming</li>
<li>Some of these "gotcha's" are common problems in other languages, many are unique to R</li>
<li>We will only cover a few &#x2013; for a more comprehensive discussion please see <a href="http://www.burns-stat.com/pages/Tutor/R_inferno.pdf">http://www.burns-stat.com/pages/Tutor/R_inferno.pdf</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline33" class="outline-3">
<h3 id="orgheadline33">Floating point comparison</h3>
<div class="outline-text-3" id="text-orgheadline33">
<p>
Floating point arithmetic is not exact:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock6">.1 == .3/3
</pre>
</div>

<p>
Solution: <code>use all.equal()</code>:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock7">all.equal<span style="color: #2f96dc;">(</span>.1, .3/3<span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34">Missing values</h3>
<div class="outline-text-3" id="text-orgheadline34">
<p>
R does not exclude missing values by default &#x2013; a single missing value in a vector means that many thing are unknown:
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock8">x <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span>1:10, <span style="color: #ce537a; font-weight: bold;">NA</span>, 12:20<span style="color: #2f96dc;">)</span>
c<span style="color: #2f96dc;">(</span>mean<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span>, sd<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span>, median<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span>, min<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span>, sd<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
NA is not equal to anything, not even NA
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock9"><span style="color: #ce537a; font-weight: bold;">NA</span> == <span style="color: #ce537a; font-weight: bold;">NA</span>
</pre>
</div>

<p>
Solutions: use <code>na.rm = TRUE</code> option when calculating, and is.na to test for missing
</p>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-3">
<h3 id="orgheadline35">Automatic type conversion</h3>
<div class="outline-text-3" id="text-orgheadline35">
<p>
Automatic type conversion happens a lot which is often useful, but makes it easy to miss mistakes
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock10"><span style="color: #2aa198;"># </span><span style="color: #2aa198;">combining values coereces them to the most general type</span>
<span style="color: #2f96dc;">(</span>x <span style="color: #a45bad;">&lt;-</span> c<span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">TRUE</span>, <span style="color: #ce537a; font-weight: bold;">FALSE</span>, 1, 2, <span style="color: #2d9574;">"a"</span>, <span style="color: #2d9574;">"b"</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
str<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>

<span style="color: #2aa198;"># </span><span style="color: #2aa198;">comparisons convert arguments to most general type</span>
1 &gt; <span style="color: #2d9574;">"a"</span>
</pre>
</div>

<p>
Maybe this is what you expect&#x2026; I would like to at least get a warning!
</p>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36">Optional argument inconsistencies</h3>
<div class="outline-text-3" id="text-orgheadline36">
<p>
Functions you might expect to work similarly don't always:
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock11">mean<span style="color: #2f96dc;">(</span>1, 2, 3, 4, 5<span style="color: #2f96dc;">)</span>*5
sum<span style="color: #2f96dc;">(</span>1, 2, 3, 4, 5<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Why are these different?!?
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock12">args<span style="color: #2f96dc;">(</span>mean<span style="color: #2f96dc;">)</span>
args<span style="color: #2f96dc;">(</span>sum<span style="color: #2f96dc;">)</span>
</pre>
</div>

<p>
Ouch. That is not nice at all!
</p>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-3">
<h3 id="orgheadline37">Trouble with Factors</h3>
<div class="outline-text-3" id="text-orgheadline37">
<p>
Factors sometimes behave as numbers, and sometimes as characters, which can be confusing!
</p>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock13"><span style="color: #2f96dc;">(</span>x <span style="color: #a45bad;">&lt;-</span> factor<span style="color: #bc6ec5;">(</span>c<span style="color: #2d9574;">(</span>5, 5, 6, 6<span style="color: #2d9574;">)</span>, levels = c<span style="color: #2d9574;">(</span>6, 5<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>

str<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>

as.character<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;"># </span><span style="color: #2aa198;">here is where people sometimes get lost...</span>
as.numeric<span style="color: #2f96dc;">(</span>x<span style="color: #2f96dc;">)</span>
<span style="color: #2aa198;"># </span><span style="color: #2aa198;">you probably want</span>
as.numeric<span style="color: #2f96dc;">(</span>as.character<span style="color: #bc6ec5;">(</span>x<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-2">
<h2 id="orgheadline39">What else?</h2>
<div class="outline-text-2" id="text-orgheadline39">
<p>
If there is anything else you want to learn how to do, now is the time to ask!
</p>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-2">
<h2 id="orgheadline42">Additional resources</h2>
<div class="outline-text-2" id="text-orgheadline42">
</div><div id="outline-container-orgheadline40" class="outline-3">
<h3 id="orgheadline40">Additional reading and resources</h3>
<div class="outline-text-3" id="text-orgheadline40">
<ul class="org-ul">
<li>Learn from the best: <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a></li>
<li>S3 system overview: <a href="https://github.com/hadley/devtools/wiki/S3">https://github.com/hadley/devtools/wiki/S3</a></li>
<li>S4 system overview: <a href="https://github.com/hadley/devtools/wiki/S4">https://github.com/hadley/devtools/wiki/S4</a></li>
<li>R documentation: <a href="http://cran.r-project.org/manuals.html">http://cran.r-project.org/manuals.html</a></li>
<li>Collection of R tutorials: <a href="http://cran.r-project.org/other-docs.html">http://cran.r-project.org/other-docs.html</a></li>

<li>R for Programmers (by Norman Matloff, UC&#x2013;Davis)</li>
</ul>
<p>
<a href="http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf">http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf</a>
</p>
<ul class="org-ul">
<li>Calling C and Fortran from R (by Charles Geyer, UMinn)</li>
</ul>
<p>
<a href="http://www.stat.umn.edu/~charlie/rc/">http://www.stat.umn.edu/~charlie/rc/</a>
</p>
<ul class="org-ul">
<li>State of the Art in Parallel Computing with R (Schmidberger et al.)</li>
</ul>
<p>
<a href="http://www.jstatso%7C.org/v31/i01/paper">http://www.jstatso%7C.org/v31/i01/paper</a>
</p>

<ul class="org-ul">
<li>Institute for Quantitative Social Science: <a href="http://iq.harvard.edu/">http://iq.harvard.edu/</a></li>
<li>Research technology consulting: <a href="http://projects.iq.harvard.edu/rtc">http://projects.iq.harvard.edu/rtc</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline41" class="outline-3">
<h3 id="orgheadline41">Feedback</h3>
<div class="outline-text-3" id="text-orgheadline41">
<ul class="org-ul">
<li>Help Us Make This Workshop Better!</li>
<li>Please take a moment to fill out a very short feedback form</li>
<li>These workshops exist for you &#x2013; tell us what you need!</li>
<li><a href="http://tinyurl.com/RprogrammingFeedback">http://tinyurl.com/RprogrammingFeedback</a></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgheadline49" class="outline-2">
<h2 id="orgheadline49">OLD STUFF</h2>
<div class="outline-text-2" id="text-orgheadline49">
</div><div id="outline-container-orgheadline43" class="outline-3">
<h3 id="orgheadline43">Vector types</h3>
<div class="outline-text-3" id="text-orgheadline43">
<p>
Vectors are the building blocks of data objects in R. There are a few basic types, including <code>logical</code>, <code>integer</code> , <code>double</code>, <code>complex</code>, and <code>character</code>. Values can be combined into vectors using the <code>c()</code> function.
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock14">num.var <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span>1, 2, 3, 4<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">numeric vector</span>
char.var <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"1"</span>, <span style="color: #2d9574;">"2"</span>, <span style="color: #2d9574;">"3"</span>, <span style="color: #2d9574;">"4"</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">character vector</span>
log.var <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span><span style="color: #ce537a; font-weight: bold;">TRUE</span>, <span style="color: #ce537a; font-weight: bold;">TRUE</span>, <span style="color: #ce537a; font-weight: bold;">FALSE</span>, <span style="color: #ce537a; font-weight: bold;">TRUE</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">logical vector</span>
char.var2 <span style="color: #a45bad;">&lt;-</span> c<span style="color: #2f96dc;">(</span>num.var, char.var<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">numbers coverted to character</span>
</pre>
</div>

<p>
Vectors can be converted from one class to another using one of the many functions beginning with <code>as.</code>, e.g., <code>as.numeric</code> and <code>as.character</code>.
</p>
<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock15">class<span style="color: #2f96dc;">(</span>char.var2<span style="color: #2f96dc;">)</span>
num.var2 <span style="color: #a45bad;">&lt;-</span> as.numeric<span style="color: #2f96dc;">(</span>char.var2<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">convert to numeric</span>
class<span style="color: #2f96dc;">(</span>num.var2<span style="color: #2f96dc;">)</span>
mean<span style="color: #2f96dc;">(</span>as.numeric<span style="color: #bc6ec5;">(</span>char.var2<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">now we can calculate the mean</span>
as.numeric<span style="color: #2f96dc;">(</span>c<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"a"</span>, <span style="color: #2d9574;">"b"</span>, <span style="color: #2d9574;">"c"</span><span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">cannot convert letters to numeric</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="orgheadline44">Vector attributes</h3>
<div class="outline-text-3" id="text-orgheadline44">
<p>
Vectors (and other R objects for that matter) will always have <code>mode</code> and <code>length</code> attributes. They may optionally have other attributes such as names or comments. 
</p>
<div class="org-src-container">

<pre class="src src-R">ls<span style="color: #2f96dc;">()</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">list objects in our workspace</span>
length<span style="color: #2f96dc;">(</span>char.var<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">how many elements in char.var?</span>
str<span style="color: #2f96dc;">(</span>num.var2<span style="color: #2f96dc;">)</span> <span style="color: #2aa198;"># </span><span style="color: #2aa198;">what is the structure of num.var2?</span>
names<span style="color: #2f96dc;">(</span>num.var2<span style="color: #2f96dc;">)</span> <span style="color: #a45bad;">&lt;-</span> paste<span style="color: #2f96dc;">(</span><span style="color: #2d9574;">"element"</span>, seq_along<span style="color: #bc6ec5;">(</span>num.var2<span style="color: #bc6ec5;">)</span><span style="color: #2f96dc;">)</span>
str<span style="color: #2f96dc;">(</span>num.var2<span style="color: #2f96dc;">)</span>
</pre>
</div>

<pre class="example">
&gt; ls() # list objects in our workspace
[1] "char.var"  "char.var2" "log.var"   "num.var"   "num.var2" 
[6] "tmp"      
&gt; length(char.var) # how many elements in char.var?
[1] 4
&gt; str(num.var2) # what is the structure of num.var2?
 num [1:8] 1 2 3 4 1 2 3 4
&gt;
</pre>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-3">
<h3 id="orgheadline45">Factor vectors</h3>
<div class="outline-text-3" id="text-orgheadline45">
<p>
Factors are stored as numbers, but have character labels. Factors are useful for
</p>
<ul class="org-ul">
<li>Modeling (automatically contrast coded)</li>
<li>Sorting/presenting values in arbitrary order</li>
</ul>

<p>
Most of the time we can treat factors as though they were character vectors
</p>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-3">
<h3 id="orgheadline46">Lists and data.frames</h3>
<div class="outline-text-3" id="text-orgheadline46">
<ul class="org-ul">
<li>A <i>data.frame</i> is a list of vectors, each of the same length</li>
<li>A <i>list</i> is a collection of objects each of which can be almost anything</li>
</ul>

<div class="org-src-container">

<pre class="src src-R" id="orgsrcblock16">DF <span style="color: #a45bad;">&lt;-</span> data.frame<span style="color: #2f96dc;">(</span>x=1:5, y=letters<span style="color: #bc6ec5;">[</span>1:5<span style="color: #bc6ec5;">]</span><span style="color: #2f96dc;">)</span>
DF <span style="color: #2aa198;"># </span><span style="color: #2aa198;">data.frame with two columns and 5 rows</span>
DF$x <span style="color: #2aa198;"># </span><span style="color: #2aa198;">select just the x column.</span>

<span style="color: #2aa198;"># </span><span style="color: #2aa198;">DF &lt;- data.frame(x=1:10, y=1:7) # illegal becase lengths differ</span>
L <span style="color: #a45bad;">&lt;-</span> list<span style="color: #2f96dc;">(</span>x=1:5, y=1:3, z = DF<span style="color: #2f96dc;">)</span>
L <span style="color: #2aa198;"># </span><span style="color: #2aa198;">lists are much more flexible!</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47">Data types summary</h3>
<div class="outline-text-3" id="text-orgheadline47">
<p>
Key points:
</p>
<ul class="org-ul">
<li>vector classes include numeric, logical, character, and factors</li>
<li>vectors can be combined into lists or  data.frames</li>
<li>a data.frame can almost always be thought of as a list of vectors of equal length</li>
<li>a list is a collection of objects, each of which can by of almost any type</li>
</ul>
<p>
Functions introduced in this section: 
</p>
<dl class="org-dl">
<dt>c</dt><dd>combine elements</dd>
<dt>as.numeric</dt><dd>convert an object (e.g., a character verctor) to numeric</dd>
<dt>data.frame</dt><dd>combine oject into a data.frame</dd>
<dt>ls</dt><dd>list the objects in the workspace</dd>
<dt>class</dt><dd>get the class of an object</dd>
<dt>str</dt><dd>get the structure of an object</dd>
<dt>length</dt><dd>get the number of elements in an object</dd>
<dt>mean</dt><dd>calculate the mean of a vector</dd>
<dt>$</dt><dd>extraction operator, selects a single element from a list or data.frame</dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48">Exercise 0</h3>
<div class="outline-text-3" id="text-orgheadline48">
<p>
Use the built-in <i>iris</i> data set (comes with R, will be available in your workspace automatically).
</p>
<ol class="org-ol">
<li>Determine the <code>class</code> and <code>str</code> ucture of the <i>iris</i> data set.</li>
<li>Determine the class of each column in the iris data set</li>
<li>BONUS (OPTIONAL): Create a new variable by <code>c</code> ombining the Petal.Length and Petal.Width columns</li>
<li>BONUS (OPTIONAL): Create a new data.frame with two columns; the first should be named <i>value</i>, and should be equal to the variable you created in step 3. The second should be named <i>variable</i> and should be either <i>Petal.Length</i> or <i>Petal.Width</i> as appropriate.</li>
</ol>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
Center for Economic and Policy Research. 2015. CPS ORG Uniform Extracts, Version 2.0.1. Washington, DC.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags">http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
Photo by Hadley Wickham via <a href="https://twitter.com/hadleywickham/status/643381054758363136/photo/1">https://twitter.com/hadleywickham/status/643381054758363136/photo/1</a>. Used by permission.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p><a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by-sa/4.0/80x15.png' /></a><span xmlns:dct='http://purl.org/dc/terms/' property='dct:title'> These statistical software workshop materials</span> by <a xmlns:cc='http://creativecommons.org/ns#' href='http://rtc.iq.harvard.edu' property='cc:attributionName' rel='cc:attributionURL'>Harvard University</a> are licensed under a <a rel='license' href='http://creativecommons.org/licenses/by-sa/4.0/'>Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p> <p> Presented by <a href='http://rtc.iq.harvard.edu'>Research Technology Consulting</a> at <br></br> <a href='http://iq.harvard.edu'><img style='margin-left: auto; margin-right: auto;' alt='The Institute for Quantitative Social Science' title='IQSS logo' src='http://static.projects.iq.harvard.edu/files/styles/os_files_small/public/rtc/files/iqsslogo-2014_0.png'></img></a></p>
</div>
</body>
</html>
