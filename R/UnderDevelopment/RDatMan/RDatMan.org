#+TITLE:     Data Management in R
#+AUTHOR:    Ista Zahn 
#+EMAIL:     dataclass@help.hmdc.harvard.edu
#+DATE:      November 2nd, 2012


#+OPTIONS:   H:2 toc:t \n:nil d:nil
#+startup: beamer inlineimages
#+COLUMNS: %20ITEM %13BEAMER_env(Env) %6BEAMER_envargs(Args) %4BEAMER_col(Col) %7BEAMER_extra(Extra)
#+PROPERTY: BEAMER_col_ALL 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 0.0 :ETC
#+PROPERTY: cache no
#+PROPERTY: exports results
#+PROPERTY: results output
#+PROPERTY: comments org
#+PROPERTY: session nil
#+PROPERTY: tangle RDatManCodeOnly.R

#+LaTeX_CLASS: beamer
#+LaTeX_CLASS_OPTIONS: [table,smaller]

#+LaTeX_HEADER: \usepackage{tikz}
#+LaTeX_HEADER: \usepackage{minted}
#+LaTeX_HEADER: \usepackage{fancyvrb}
#+LaTeX_HEADER: \usemintedstyle{perldoc}
#+LaTeX_HEADER: \definecolor{lightgray}{gray}{0.96}
#+LaTeX_HEADER: \setlength{\tabcolsep}{1ex}
#+LaTeX_HEADER: \institute{Harvard MIT Data Center}
#+latex_header: \usetheme{Warsaw}
#+latex_header: \useoutertheme{infolines}
#+latex_header: \setbeamercolor{block body}{bg=lightgray}
#+latex_header: \titlegraphic{\includegraphics[width=.75\textwidth]{images/IQSSNewLogo.pdf}}
#+LaTex_header: \setbeamersize{text margin left=2em,text margin right=2em}
#+latex_header: \AtBeginSection[]{\begin{frame}<beamer>\frametitle{Topic}\tableofcontents[currentsection]\end{frame}}

* Introduction
#+LaTeX: \rowcolors{1}{blue!15}{blue!3}
#+LaTeX: \definecolor{bg}{rgb}{0.95,0.95,0.95}
#+LaTeX: \definecolor{cbg}{cmyk}{0,0,.1,0}

#+name: setup-minted
#+begin_src emacs-lisp :exports none :results silent :tangle no
   (setq org-babel-R-command "R --silent --save --restore")
  ;       ;"R --slave --no-save")
   (setq org-e-latex-listings 'minted)
   (setq org-e-latex-minted-options
         '(("fontsize" "\\footnotesize")))
   (setq org-e-latex-pdf-process
         '("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
           "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
   
   (setq LaTeX-command "pdflatex -shell-escape") 
   
   (add-hook 'org-babel-after-execute-hook 'org-display-inline-images)
   
   (setq org-e-latex-image-default-option "")
   (setq org-babel-min-lines-for-block-output 0)
   (setq org-export-babel-evaluate nil)
   (setq org-export-latex-minted-langs 'nil)
   (add-to-list 'org-e-latex-minted-langs '(R "r"))
  
  (defun my-latex-fixed-width-start (fixed-width backend info)
    (when (org-export-derived-backend-p backend 'e-latex)
      (replace-regexp-in-string
       "\\(begin{verbatim\\)}"
       "vspace{-.5em}
  \\\\begin{columns}
  \\\\column{.95\\\\linewidth}
  \\\\begin{block}{}
  \\\\begin{minted}[linenos=false, fontsize=\\\\footnotesize]{rconsole" fixed-width nil nil 1)))
  
  (defun my-latex-fixed-width-end (fixed-width backend info)
    (when (org-export-derived-backend-p backend 'e-latex)
      (replace-regexp-in-string
       "\\(end\\){\\(verbatim\\)}"
       "minted}
  \\\\end{block}
  \\\\end{columns}
  \\\\vspace{.5em" fixed-width nil nil 2)))
  
  (add-to-list 'org-export-filter-final-output-functions
               'my-latex-fixed-width-start)
  (add-to-list 'org-export-filter-final-output-functions
               'my-latex-fixed-width-end)
#+end_src

#+name: setupR
#+begin_src R :exports none :tangle no
  rm(list=ls())
  .First <- function() {
    options(width=70)
    options(useFancyQuotes=FALSE)
    options(show.signif.stars=FALSE)
  }
#+end_src


** Materials and setup

- USERNAME: dataclass
- PASSWORD: dataclass

- Find class materials at
[[http://projects.iq.harvard.edu/rtc/RDatMan]]

- *Download the zip file at the bottom of the page and unzip on your desktop!*

** Copy the workshop materials to your home directory		   :noexport:

- *Log in to an Athena workstation* using your Athena user name and password

- *Click on the "Ubuntu" button* on the upper-left and type "term" as shown below
#+attr_latex: :options "width=.8\\textwidth"
 [[./images/OpenTerminal.png]]

- *Click on the "Terminal" icon* as shown above

- In the terminal, *type this line exactly as shown*:
: cd; wget http://tinyurl.com/RDatMan-zip; unzip RDatMan-zip

- If you see "ERROR 404: Not Found", then you mistyped the command -- try again, making sure to type the command exactly as shown

** Launch RStudio on Athena					   :noexport:

- To start R *type these commands in the terminal*:
:     add r
:     rstudio
- Open up today's R script

  - In RStudio, Go to *File => Open Script*

  - Locate and open the =RDatMan.R= script in the RDatMan folder in your home directory

- Go to *Tools => Set working directory => To source file location* (more on the working directory later)

- I encourage you to add your own notes to this file!


** Launch RStudio 						   :noexport:

- Open the RStudio program from the Windows start menu

- Open up today's R script

  - In RStudio, Go to *File => Open Script*

  - Locate and open the =RDatMan.R= script in the RDatMan folder on your desktop

- Go to *Tools => Set working directory => To source file location* (more on the working directory later)

- I encourage you to add your own notes to this file!
  

** Some thoughts on data management
#+begin_quote
It's often said that 80% of the effort of analysis is in data cleaning. Despite the amount of time it takes, there has been little research on how to clean data well.

  --Hadley Wickham, [[http://vita.had.co.nz/papers/tidy-data.pdf]]
#+end_quote

#+begin_quote
Another thing that parenting and the "dirty jobs" of research have in common is that nobody gets taught how to do it. Parents just learn on the job and researchers typically have to do likewise when it comes to learning how to manage their data.

  --Paul Murrell, [[http://www.stat.auckland.ac.nz/~paul/ItDT/HTML/]]
#+end_quote

** Data management in R
- R offers a variety of data object types: learning which object types are most appropriate for different situations is a prime goal of this workshop

- R has powerful data management tools, many of which are available in add on packages rather than in R-core
- We will use the following packages in this workshop
- plyr :: split-apply-combine tasks
- reshape2 :: convert wide <--> long format
- XLConnect :: interface with Excel


* R data objects

** Data object types
- *vectors* are the lowest-level data object type in R. Vectors are one-dimensional structures that can be combined to form more complex data objects. Vectors types include logical (T/F), numeric, and character
- A *matrix* is a vector with two dimensions (rows and columns)
- An *array* is a vector with more than one dimension (e.g., a cube)
- A *list* is a flexible data structure in which each element can by any type of R object 
- A *data.frame* is a special kind of list, and is the most common way to store data sets. A data.frame consist of columns (usually vectors of equal length) and rows.



* Wrap-up

** Help us make this workshop better!

- Please take a moment to fill out a very short feedback form

- These workshops exist for you â€“ tell us what you need!

- http://tinyurl.com/R-intro-feedback

** Additional resources

- IQSS workshops: http://projects.iq.harvard.edu/rtc/filter_by/workshops

- MIT workshops: [[http://libraries.mit.edu/sites/news/check-complete-listing-5/9319/]]

# - IQSS statistical consulting: http://rtc.iq.harvard.edu

- Software (all free!):
  - R and R package download: http://cran.r-project.org
  - Rstudio download: http://rstudio.org
  - ESS (emacs R package): http://ess.r-project.org/

- Getting help:
  - Documentation and tutorials: http://cran.r-project.org/other-docs.html
  - Recommended R packages by topic: http://cran.r-project.org/web/views/
  - Mailing list: https://stat.ethz.ch/mailman/listinfo/r-help
  - StackOverflow: http://stackoverflow.com/questions/tagged/r


** Cleanup							   :noexport:
#+name: cleanup
#+begin_src R :exports none
  system("rm dataSets/myWorkspace.RData")
  system("rm dataSets/NewGSS.csv")
#+end_src

#+RESULTS: cleanup
#+begin_example
> system("rm dataSets/myWorkspace.RData")
> system("rm dataSets/NewGSS.csv")
> 
#+end_example



